<view class="container">
  <!-- é€šç”¨æ‚¬æµ®é“ƒé“›ç»„ä»¶ -->
  <floating-bell />

  <!-- ä»“åº“ç®¡ç†å¡ç‰‡ -->
  <view class="card">
    <view class="title">ä»“åº“</view>
    <view class="grid-menu">
      <view class="grid-item" bindtap="navTo" data-url="/pages/warehouse/sample/list/index">
        <view class="icon-box bg-soft-blue">
          <text class="iconfont">ğŸ§¥</text>
        </view>
        <text class="menu-name">æ ·è¡£åº“å­˜</text>
      </view>
      <view class="grid-item" bindtap="navTo" data-url="/pages/warehouse/finished/list/index">
        <view class="icon-box bg-soft-indigo">
          <text class="iconfont">ï¿½</text>
        </view>
        <text class="menu-name">æˆå“ç®¡ç†</text>
      </view>
      <view class="grid-item" bindtap="navTo" data-url="/pages/warehouse/order-ranking/index">
        <view class="icon-box bg-soft-amber">
          <text class="iconfont">ğŸ·ï¸</text>
        </view>
        <text class="menu-name">ä¸‹å•æ’è¡Œ</text>
      </view>
      <view class="grid-item" bindtap="navTo" data-url="/pages/warehouse/material/alerts/index">
        <view class="icon-box bg-soft-green">
          <text class="iconfont">ğŸ§µ</text>
        </view>
        <text class="menu-name">é¢è¾…æ–™æ’è¡Œ</text>
      </view>
    </view>
  </view>

  <view class="card">
    <view class="title-row">
      <view class="title">ç”Ÿäº§</view>
      <view class="title-stats">
        <text>è®¢å•</text>
        <text class="title-stat-value title-stat-primary">{{orderStats.orderCount}}</text>
        <text class="title-stat-sep">ï½œ</text>
        <text>æ€»é‡</text>
        <text class="title-stat-value title-stat-accent">{{orderStats.totalQuantity}}</text>
      </view>
    </view>

    <!-- æœç´¢ç»„ä»¶æ”¾åœ¨æœ€ä¸Šé¢ -->
    <global-search
      keyword="{{globalSearch.keyword}}"
      results="{{globalSearch.results}}"
      has-searched="{{globalSearch.hasSearched}}"
      bind:input="onGlobalSearchInput"
      bind:search="doGlobalSearch"
      bind:clear="clearGlobalSearch"
      bind:close="closeGlobalSearch"
      bind:itemtap="onResultItemTap"
    />

    <!-- æ ‡ç­¾æ åœ¨æœç´¢æ ä¸‹é¢ -->
    <view class="tabbar">
      <view class="tab {{activeTab === 'all' ? 'tab-active' : ''}}" data-tab="all" bindtap="onTab">å…¨éƒ¨</view>
      <view class="tab {{activeTab === 'procurement' ? 'tab-active' : ''}}" data-tab="procurement" bindtap="onTab">é‡‡è´­</view>
      <view class="tab {{activeTab === 'cutting' ? 'tab-active' : ''}}" data-tab="cutting" bindtap="onTab">è£å‰ª</view>
      <view class="tab {{activeTab === 'sewing' ? 'tab-active' : ''}}" data-tab="sewing" bindtap="onTab">è½¦ç¼</view>
      <view class="tab {{activeTab === 'warehousing' ? 'tab-active' : ''}}" data-tab="warehousing" bindtap="onTab">å…¥åº“</view>
    </view>

    <!-- è®¢å•åˆ—è¡¨ -->

      <view wx:if="{{orders.list.length === 0 && !orders.loading}}" class="hint">æš‚æ— æ•°æ®</view>
        <view wx:for="{{orders.list}}" wx:key="id" class="list-item {{item.isClosed ? 'list-item-closed' : ''}} {{highlightOrderNo && item.orderNo === highlightOrderNo ? 'list-item-highlight' : ''}} {{item.remainDaysClass === 'days-overdue' ? 'list-item-overdue' : ''}}">
          <view class="item-body">
            <!-- å·¦ä¾§æ¬¾å¼å›¾ç‰‡ -->
            <view class="item-cover-box">
              <image wx:if="{{item.styleCoverUrl}}" class="item-cover" src="{{item.styleCoverUrl}}" mode="aspectFill" lazy-load />
              <view wx:else class="item-cover-empty">æš‚æ— \nå›¾ç‰‡</view>
            </view>
            <!-- å³ä¾§ä¿¡æ¯åŒº -->
            <view class="item-info">
              <view class="item-head">
                <view class="item-title {{item.isClosed ? 'item-title-closed' : ''}}">
                  {{item.orderNo || '-'}}
                  <text wx:if="{{item.remainDaysClass === 'days-overdue'}}" class="overdue-indicator">â°å»¶æœŸ</text>
                </view>
                <view class="item-tags">
                  <!-- å·²å®Œæˆæ˜¾ç¤º"å·²å®Œæˆ"æ ‡ç­¾ï¼Œå¦åˆ™æ˜¾ç¤ºå½“å‰å·¥åº -->
                  <text wx:if="{{item.isClosed}}" class="tag tag-completed">å·²å®Œæˆ</text>
                  <text wx:elif="{{item.currentProcessName}}" class="tag {{item.currentProcessName === 'è£å‰ª' ? 'tag-process' : ''}}">{{item.currentProcessName}}</text>
                </view>
              </view>
              <view class="item-meta">
                <text class="meta-label">æ¬¾å·</text>
                <text class="meta-value">{{item.styleNo || '-'}}</text>
                <text class="meta-sep">ï½œ</text>
                <text class="meta-label">å·¥å‚</text>
                <text class="meta-value">{{item.factoryName || '-'}}</text>
              </view>
              <view class="item-qty-row">
                <text class="meta-label">æ•°é‡</text>
                <text class="meta-value meta-value-bold">{{item.sizeTotal ? item.sizeTotal : (item.orderQuantity || 0)}}</text>
                <text class="meta-sep">ï½œ</text>
                <text class="meta-label">å®Œæˆ</text>
                <text class="meta-value meta-value-bold">{{item.completedQuantity || 0}}</text>
              </view>
              <view class="progress-wrapper">
                <view class="progress-bar {{item.isClosed ? 'progress-completed' : ''}}">
                  <view class="progress-fill" style="width: {{item.productionProgress || 0}}%"></view>
                </view>
                <text class="progress-text progress-percent">{{item.productionProgress || 0}}%</text>
              </view>
            </view>
          </view>
          <!-- åº•éƒ¨ä¿¡æ¯åŒºï¼ˆç æ•°æ˜ç»† + äº¤æœŸï¼‰ -->
          <view wx:if="{{item.sizeList && item.sizeList.length}}" class="size-plain">
            <view class="size-plain-row">
              <text class="size-plain-label">ç æ•°</text>
              <text wx:for="{{item.sizeList}}" wx:key="*this" class="size-plain-cell">{{item}}</text>
            </view>
            <view class="size-plain-row">
              <text class="size-plain-label">æ•°é‡</text>
              <text wx:for="{{item.sizeQtyList}}" wx:key="index" class="size-plain-cell">{{item}}</text>
            </view>
          </view>
          <!-- äº¤æœŸä¿¡æ¯ -->
          <view wx:if="{{item.deliveryDateStr}}" class="delivery-row">
            <text class="delivery-label">äº¤æœŸï¼š{{item.deliveryDateStr}}</text>
            <text class="delivery-days {{item.remainDaysClass}}">{{item.remainDaysText}}</text>
          </view>
        </view>

      <view class="btn">
        <view class="btn-secondary {{orders.loading || !orders.hasMore ? 'btn-disabled' : ''}}" bindtap="loadMoreActive">{{orders.loading ? 'åŠ è½½ä¸­...' : (orders.hasMore ? 'åŠ è½½æ›´å¤š' : 'æ²¡æœ‰æ›´å¤šäº†')}}</view>
      </view>
  </view>

</view>
