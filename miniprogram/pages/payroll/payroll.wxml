<!-- pages/payroll/payroll.wxml -->
<view class="page">
  <!-- é€šç”¨æ‚¬æµ®é“ƒé“›ç»„ä»¶ -->
  <floating-bell />

  <!-- é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ -->
  <view class="summary-card">
    <view class="summary-title">ğŸ“± æˆ‘çš„å·¥èµ„</view>
    <view class="summary-row">
      <view class="summary-item">
        <view class="summary-label">æœ¬æœˆæ€»é‡‘é¢</view>
        <view class="summary-value primary">Â¥{{totalAmount}}</view>
      </view>
      <view class="summary-item">
        <view class="summary-label">æœ¬æœˆæ•°é‡</view>
        <view class="summary-value">{{totalQuantity}} ä»¶</view>
      </view>
    </view>
    <view class="summary-row">
      <view class="summary-item">
        <view class="summary-label">æ‰«ç æ¬¡æ•°</view>
        <view class="summary-value">{{recordCount}} æ¬¡</view>
      </view>
      <view class="summary-item">
        <view class="summary-label">å‚ä¸è®¢å•</view>
        <view class="summary-value">{{orderCount}} ä¸ª</view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å™¨ -->
  <view class="filter-bar">
    <view class="filter-tabs">
      <view class="filter-tab {{timeFilter === 'week' ? 'active' : ''}}" bindtap="onFilterChange" data-filter="week">
        æœ¬å‘¨
      </view>
      <view class="filter-tab {{timeFilter === 'month' ? 'active' : ''}}" bindtap="onFilterChange" data-filter="month">
        æœ¬æœˆ
      </view>
      <view class="filter-tab {{timeFilter === 'custom' ? 'active' : ''}}" bindtap="onFilterChange" data-filter="custom">
        è‡ªå®šä¹‰
      </view>
    </view>
  </view>

  <!-- è‡ªå®šä¹‰æ—¶é—´é€‰æ‹© -->
  <view class="custom-date" wx:if="{{timeFilter === 'custom'}}">
    <picker mode="date" value="{{startDate}}" end="{{endDate}}" bindchange="onStartDateChange">
      <view class="date-picker">å¼€å§‹ï¼š{{startDate}}</view>
    </picker>
    <picker mode="date" value="{{endDate}}" start="{{startDate}}" bindchange="onEndDateChange">
      <view class="date-picker">ç»“æŸï¼š{{endDate}}</view>
    </picker>
  </view>

  <!-- å·¥åºæ˜ç»†åˆ—è¡¨ -->
  <view class="detail-section">
    <view class="section-header">
      <view class="section-title">ã€å·¥åºæ˜ç»†ã€‘</view>
      <view class="sort-btn" bindtap="toggleSort">
        <text class="sort-text">æŒ‰é‡‘é¢</text>
        <text class="sort-icon">{{sortOrder === 'desc' ? 'â–¼' : 'â–²'}}</text>
      </view>
    </view>

    <view wx:if="{{records.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— å·¥åºè®°å½•</text>
    </view>

    <view wx:for="{{records}}" wx:key="index" class="record-item">
      <view class="record-header">
        <text class="order-info">è®¢å• {{item.orderNo}}</text>
        <text class="style-info">æ¬¾å· {{item.styleNo}}</text>
      </view>
      <view class="record-detail">
        <text class="color-size">{{item.color}} {{item.size}}</text>
        <text class="process">{{item.processName}}</text>
      </view>
      <view class="record-footer">
        <view class="calculation">
          <text class="quantity">{{item.quantity}}ä»¶</text>
          <text class="multiply">Ã—</text>
          <text class="unit-price">Â¥{{item.unitPrice}}</text>
          <text class="equals">=</text>
          <text class="amount">Â¥{{item.totalAmount}}</text>
        </view>
        <text class="time">{{item.scanTime}}</text>
      </view>
    </view>

    <!-- åº•éƒ¨ç»Ÿè®¡ -->
    <view wx:if="{{records.length > 0}}" class="bottom-summary">
      <text class="bottom-label">å½“å‰ç­›é€‰æ€»è®¡ï¼š</text>
      <text class="bottom-amount">Â¥{{filteredTotalAmount}}</text>
    </view>
  </view>
</view>
