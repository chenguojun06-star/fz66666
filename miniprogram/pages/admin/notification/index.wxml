<view class="container">
  <view class="notification-header">
    <view class="notification-icon">ğŸ””</view>
    <view class="notification-title">ç”¨æˆ·å®¡æ‰¹é€šçŸ¥</view>
    <view class="notification-count" wx:if="{{total > 0}}">{{total}}</view>
  </view>

  <view wx:if="{{loading && pendingUsers.length === 0}}" class="loading">åŠ è½½ä¸­...</view>

  <view wx:if="{{!loading && pendingUsers.length === 0}}" class="empty">
    <view class="empty-icon">âœ…</view>
    <view class="empty-text">æš‚æ— å¾…å®¡æ‰¹ç”¨æˆ·</view>
  </view>

  <view class="user-list">
    <view wx:for="{{pendingUsers}}" wx:key="id" class="user-card">
      <view class="user-header">
        <view class="user-avatar">ğŸ‘¤</view>
        <view class="user-info">
          <view class="user-name">{{item.name || item.username}}</view>
          <view class="user-meta">{{item.username}}</view>
        </view>
        <view class="user-badge">æ–°ç”¨æˆ·</view>
      </view>

      <view class="user-details">
        <view class="detail-item" wx:if="{{item.roleName}}">
          <view class="detail-label">è§’è‰²</view>
          <view class="detail-value">{{item.roleName}}</view>
        </view>
        <view class="detail-item" wx:if="{{item.phone}}">
          <view class="detail-label">æ‰‹æœº</view>
          <view class="detail-value">{{item.phone}}</view>
        </view>
        <view class="detail-item" wx:if="{{item.email}}">
          <view class="detail-label">é‚®ç®±</view>
          <view class="detail-value">{{item.email}}</view>
        </view>
        <view class="detail-item" wx:if="{{item.createTime}}">
          <view class="detail-label">æ³¨å†Œæ—¶é—´</view>
          <view class="detail-value">{{item.createTime}}</view>
        </view>
      </view>

      <view class="user-actions">
        <view
          class="action-btn reject-btn"
          data-user="{{item}}"
          bindtap="onRejectUser">
          æ‹’ç»
        </view>
        <view
          class="action-btn approve-btn"
          data-user="{{item}}"
          bindtap="onApproveUser">
          æ‰¹å‡†
        </view>
      </view>
    </view>
  </view>

  <view wx:if="{{hasMore && !loading}}" class="load-more" bindtap="onLoadMore">
    åŠ è½½æ›´å¤š
  </view>
  <view wx:if="{{loading && pendingUsers.length > 0}}" class="load-more">
    åŠ è½½ä¸­...
  </view>
  <view wx:if="{{!hasMore && pendingUsers.length > 0}}" class="load-more disabled">
    æ²¡æœ‰æ›´å¤šäº†
  </view>

  <!-- æ‰¹å‡†å¼¹çª— -->
  <view class="modal {{showApprovalModal ? 'show' : ''}}" catchtouchmove="preventMove">
    <view class="modal-mask" bindtap="cancelApprove"></view>
    <view class="modal-content">
      <view class="modal-header">
        <view class="modal-title">æ‰¹å‡†ç”¨æˆ·</view>
        <view class="modal-close" bindtap="cancelApprove">âœ•</view>
      </view>
      <view class="modal-body">
        <view class="modal-text">
          æ‰¹å‡†ç”¨æˆ· <text class="highlight">{{currentUser.name || currentUser.username}}</text>
        </view>
        <view class="modal-hint">æ‰¹å‡†åè¯¥ç”¨æˆ·å¯ä»¥æ­£å¸¸ç™»å½•ç³»ç»Ÿ</view>

        <view class="form-item">
          <view class="form-label">é€‰æ‹©è§’è‰² <text class="required">*</text></view>
          <view class="inline-selector">
            <scroll-view class="inline-selector-list" scroll-y="{{true}}" enhanced="{{true}}" show-scrollbar="{{false}}">
              <view
                wx:for="{{roleOptions}}"
                wx:key="id"
                class="inline-selector-item {{selectedRoleId === String(item.id) ? 'active' : ''}}"
                data-id="{{item.id}}"
                bindtap="onRoleSelect">
                <view class="inline-selector-left">
                  <view class="inline-selector-radio {{selectedRoleId === String(item.id) ? 'checked' : ''}}">
                    <view wx:if="{{selectedRoleId === String(item.id)}}" class="inline-selector-radio-dot"></view>
                  </view>
                  <text class="inline-selector-label">{{item.roleName}}</text>
                </view>
              </view>
            </scroll-view>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <view class="modal-btn cancel" hover-class="modal-btn-cancel-hover" hover-stay-time="100" bindtap="cancelApprove">å–æ¶ˆ</view>
        <view class="modal-btn confirm" hover-class="modal-btn-confirm-hover" hover-stay-time="100" bindtap="confirmApprove">æ‰¹å‡†å¹¶åˆ†é…è§’è‰²</view>
      </view>
    </view>
  </view>

  <!-- æ‹’ç»å¼¹çª— -->
  <view class="modal {{showRejectModal ? 'show' : ''}}" catchtouchmove="preventMove">
    <view class="modal-mask" bindtap="cancelReject"></view>
    <view class="modal-content">
      <view class="modal-header">
        <view class="modal-title">æ‹’ç»ç”¨æˆ·</view>
        <view class="modal-close" bindtap="cancelReject">âœ•</view>
      </view>
      <view class="modal-body">
        <view class="modal-text">
          ç¡®å®šæ‹’ç»ç”¨æˆ· <text class="highlight">{{currentUser.name || currentUser.username}}</text> å—ï¼Ÿ
        </view>
        <view class="modal-hint danger">æ‹’ç»åè¯¥ç”¨æˆ·å°†æ— æ³•ç™»å½•ç³»ç»Ÿ</view>

        <view class="form-item">
          <view class="form-label">æ‹’ç»åŸå›  <text class="required">*</text></view>
          <textarea
            class="textarea"
            placeholder="è¯·è¾“å…¥æ‹’ç»åŸå› "
            value="{{rejectReason}}"
            bindinput="onRejectReasonInput"
            maxlength="200"
          />
        </view>
      </view>
      <view class="modal-footer">
        <view class="modal-btn cancel" hover-class="modal-btn-cancel-hover" hover-stay-time="100" bindtap="cancelReject">å–æ¶ˆ</view>
        <view class="modal-btn confirm danger" hover-class="modal-btn-confirm-hover" hover-stay-time="100" bindtap="confirmReject">ç¡®å®šæ‹’ç»</view>
      </view>
    </view>
  </view>
</view>
