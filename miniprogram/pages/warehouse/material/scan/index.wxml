<view class="container">

  <!-- é¡¶éƒ¨æ ‡é¢˜ -->
  <view class="header">
    <text class="header-title">é¢è¾…æ–™æ–™å·å‘æ–™/é€€å›</text>
    <text class="header-sub">æ‰«æç®±/å·ä¸Šçš„ MR å¼€å¤´äºŒç»´ç </text>
  </view>

  <!-- æ‰«ç æŒ‰é’®ï¼ˆé¦–æ¬¡è¿›å…¥æ²¡æœ‰ rollCode æ—¶æ˜¾ç¤ºï¼‰ -->
  <view wx:if="{{!rollCode}}" class="scan-btn-wrap">
    <view class="scan-btn" bindtap="onScanTap">
      <text class="scan-icon">ğŸ“·</text>
      <text class="scan-label">ç‚¹å‡»æ‰«ç </text>
    </view>
    <text class="scan-hint">è¯·æ‰«æ–™å·/ç®±ä¸Šçš„ MR å¼€å¤´äºŒç»´ç </text>
  </view>

  <!-- å·²æœ‰rollCodeçš„æƒ…å†µ -->
  <view wx:else>

    <!-- æ–™å·ç¼–å· -->
    <view class="roll-code-bar">
      <text class="roll-code-label">æ–™å·ç¼–å·</text>
      <text class="roll-code-value">{{rollCode}}</text>
      <view class="btn-rescan" bindtap="onScanTap">é‡æ–°æ‰«ç </view>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading}}" class="loading-wrap">
      <text class="loading-text">æŸ¥è¯¢ä¸­...</text>
    </view>

    <!-- é”™è¯¯ä¿¡æ¯ -->
    <view wx:elif="{{errorMsg}}" class="error-card">
      <text class="error-icon">âš ï¸</text>
      <text class="error-msg">{{errorMsg}}</text>
      <view class="btn-retry" bindtap="onScanTap">é‡æ–°æ‰«ç </view>
    </view>

    <!-- æˆåŠŸä¿¡æ¯ -->
    <view wx:if="{{successMsg}}" class="success-banner">
      <text class="success-icon">âœ…</text>
      <text class="success-text">{{successMsg}}</text>
    </view>

    <!-- æ–™å·ä¿¡æ¯å¡ç‰‡ -->
    <view wx:if="{{rollInfo}}" class="info-card">
      <view class="info-row">
        <text class="info-label">ç‰©æ–™</text>
        <text class="info-value">{{rollInfo.materialName}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">ç¼–ç </text>
        <text class="info-value">{{rollInfo.materialCode}}</text>
      </view>
      <view wx:if="{{rollInfo.color}}" class="info-row">
        <text class="info-label">é¢œè‰²</text>
        <text class="info-value">{{rollInfo.color}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">æ•°é‡</text>
        <text class="info-value bold">{{rollInfo.quantity}} {{rollInfo.unit}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">åº“ä½</text>
        <text class="info-value">{{rollInfo.warehouseLocation}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">å…¥åº“å•</text>
        <text class="info-value">{{rollInfo.inboundNo || '-'}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">å½“å‰çŠ¶æ€</text>
        <view class="status-tag {{rollInfo.currentStatus === 'IN_STOCK' ? 'tag-green' : 'tag-orange'}}">
          {{rollInfo.currentStatus === 'IN_STOCK' ? 'åœ¨åº“' : (rollInfo.currentStatus === 'ISSUED' ? 'å·²å‘æ–™' : rollInfo.currentStatus)}}
        </view>
      </view>
    </view>

    <!-- æ“ä½œåŒºï¼ˆä»…åœ¨æŸ¥åˆ°æ–™å·ä¿¡æ¯åæ˜¾ç¤ºï¼‰ -->
    <view wx:if="{{rollInfo && !successMsg}}" class="action-area">

      <!-- å…³è”è£å‰ªå•å·ï¼ˆå¯é€‰ï¼‰ -->
      <view wx:if="{{rollInfo.currentStatus === 'IN_STOCK'}}" class="input-row">
        <text class="input-label">å…³è”è£å‰ªå•ï¼ˆå¯é€‰ï¼‰</text>
        <input
          class="input-field"
          placeholder="è¾“å…¥è£å‰ªå•å·ï¼Œå¦‚ CO20260219001"
          value="{{cuttingOrderNo}}"
          bindinput="onCuttingOrderInput"
        />
      </view>

      <!-- æŒ‰é’® -->
      <view wx:if="{{rollInfo.currentStatus === 'IN_STOCK'}}" class="btn-issue {{submitting ? 'btn-disabled' : ''}}" bindtap="onIssueTap">
        {{submitting ? 'å¤„ç†ä¸­...' : 'âœ… ç¡®è®¤å‘æ–™å‡ºåº“'}}
      </view>

      <view wx:elif="{{rollInfo.currentStatus === 'ISSUED'}}" class="btn-return {{submitting ? 'btn-disabled' : ''}}" bindtap="onReturnTap">
        {{submitting ? 'å¤„ç†ä¸­...' : 'â†©ï¸ é€€å›å…¥åº“'}}
      </view>

    </view>

    <!-- æ‰«ä¸‹ä¸€ä¸ª -->
    <view wx:if="{{rollInfo}}" class="btn-next" bindtap="onScanNextTap">
      æ‰«ä¸‹ä¸€ä¸ªæ–™å·
    </view>

  </view>

</view>
