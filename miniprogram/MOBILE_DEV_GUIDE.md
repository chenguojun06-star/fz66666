# 手机端代码规范与迭代管理文档

## 1. 代码迭代管理规范

### 1.1 版本号规范 (Semantic Versioning)
采用 `Major.Minor.Patch` 格式：
*   **Major (主版本号)**: 架构升级或重大重构（如 v1.0.0 -> v2.0.0）。
*   **Minor (次版本号)**: 新功能发布（如 v1.1.0 -> v1.2.0）。
*   **Patch (修订号)**: Bug 修复或微小调整（如 v1.2.0 -> v1.2.1）。

### 1.2 迭代日志 (CHANGELOG)
所有变动必须记录在 `CHANGELOG.md` 中，格式如下：

```markdown
## [1.2.0] - 2026-02-26
### ✨ 新增
- 首页新增“生产进度”快捷入口。
- 扫码页面支持手动输入工单号。

### 🐛 修复
- 修复了 iOS 下日期选择器样式错乱的问题。
- 修复了弱网环境下数据同步延迟的问题。

### ⚡ 优化
- 优化了扫码界面的相机启动速度。
```

## 2. 代码逻辑规范

### 2.1 目录结构分层
手机端代码需严格遵循以下分层结构：

```text
miniprogram/
├── components/       # UI 组件层（只负责展示，不含业务逻辑）
├── pages/            # 页面层（负责路由参数、页面生命周期）
├── services/         # 业务逻辑层（核心业务逻辑，如 scanCoreMixin.js）
├── utils/            # 工具层（纯函数，无状态）
│   ├── api.js        # API 请求封装
│   ├── uiHelper.js   # UI 交互封装（Toast, Modal）
│   └── dataTransform.js # 数据转换与格式化
└── styles/           # 样式层（全局样式、设计 Token）
```

### 2.2 核心逻辑规范
*   **数据转换**：后端返回的数据必须通过 `utils/dataTransform.js` 进行清洗和格式化，禁止在页面逻辑中直接处理原始数据（如 `null` 判断）。
*   **UI 交互**：所有提示（Toast）、弹窗（Modal）必须通过 `utils/uiHelper.js` 调用，禁止直接使用 `wx.showToast`，以便统一风格和全局控制。
*   **表单验证**：使用 `utils/validationRules.js` 中的规则，禁止在页面中手写 `if (value === '')`。

## 3. 冗余代码清理指南
定期（每月一次）执行以下清理：
1.  **未使用的文件**：使用 `ls` 和 `grep` 检查未被引用的 `.js` 和 `.wxss` 文件。
2.  **废弃资源**：检查 `assets/` 目录下未被引用的图片。
3.  **注释代码**：提交代码前必须删除所有注释掉的代码块（`// code...`）。
4.  **Console.log**：生产环境代码禁止包含 `console.log`。

## 4. 常见问题排查 (Troubleshooting)
*   **数据不同步**：检查是否正确使用了 `eventBus` 进行跨页面通知。
*   **样式兼容性**：检查是否使用了非标准的 CSS 属性，优先使用 `design-tokens.wxss` 中的变量。
