# 智能编排接口契约（字段级）

## 1) `POST /api/intelligence/precheck/scan`

### Request
```json
{
  "orderId": "PO_ID",
  "orderNo": "PO20260227001",
  "stageName": "车缝",
  "processName": "锁边",
  "quantity": 50,
  "operatorId": "1001",
  "operatorName": "张三"
}
```

### Response.data
```json
{
  "riskLevel": "LOW|MEDIUM|HIGH",
  "issues": [
    {
      "code": "INTEL_PRECHECK_INVALID_QUANTITY",
      "level": "MEDIUM",
      "title": "扫码数量异常",
      "reason": "quantity 必须大于 0",
      "suggestion": "请修正扫码数量后再提交"
    }
  ],
  "suggestions": ["预检通过，可继续执行扫码"],
  "traceId": null
}
```

---

## 2) `POST /api/intelligence/predict/finish-time`

### Request
```json
{
  "orderId": "PO_ID",
  "orderNo": "PO20260227001",
  "stageName": "尾部",
  "processName": "剪线",
  "currentProgress": 65
}
```

### Response.data
```json
{
  "predictionId": "PRED-xxxx",
  "predictedFinishTime": "2026-02-28T10:30:00",
  "confidence": 0.62,
  "reasons": ["规则引擎占位预测"],
  "suggestions": ["建议补充历史耗时特征后切换到模型预测"]
}
```

---

## 3) `POST /api/intelligence/recommend/inout`

### Request
```json
{
  "orderNo": "PO20260227001",
  "operatorId": "1001",
  "operatorName": "张三",
  "purchaseIds": ["P001", "P002"]
}
```

### Response.data
```json
{
  "strategy": "OUTBOUND_FIRST|PURCHASE",
  "reason": "默认建议优先走库存出库，不足部分再采购",
  "suggestions": ["建议调用 smart-receive-preview 先预览分流结果"],
  "relatedPurchaseIds": ["P001", "P002"]
}
```

---

## 4) `POST /api/intelligence/feedback`

### Request
```json
{
  "predictionId": "PRED-xxxx",
  "orderId": "PO_ID",
  "orderNo": "PO20260227001",
  "stageName": "车缝",
  "processName": "锁边",
  "predictedFinishTime": "2026-02-27T18:00:00",
  "actualFinishTime": "2026-02-27T19:30:00",
  "actualResult": "DELAYED",
  "acceptedSuggestion": true
}
```

### Response.data
```json
{
  "accepted": true,
  "deviationMinutes": 90,
  "message": "反馈已接收（占位实现）"
}
```
