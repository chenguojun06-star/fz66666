# å¤šç§Ÿæˆ·å¤šç³»ç»Ÿå¯¹æ¥å®Œæ•´æ–¹æ¡ˆ

> **é€‚ç”¨åœºæ™¯**ï¼šä¸€ä¸ªç§Ÿæˆ·ï¼ˆæœè£…å‚ï¼‰éœ€è¦åŒæ—¶å¯¹æ¥å¤šä¸ªç¬¬ä¸‰æ–¹ERPç³»ç»Ÿ
> **æŠ€æœ¯æ–¹æ¡ˆ**ï¼šåŸºäº TenantApp çš„å¤šåº”ç”¨éš”ç¦»æœºåˆ¶

---

## ğŸ¯ ä¸šåŠ¡åœºæ™¯

### å…¸å‹æ¡ˆä¾‹ï¼šå¤§å‹æœè£…å‚å¯¹æ¥å¤šä¸ªERP

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æœè£…å‚ï¼ˆç§Ÿæˆ·ID: 1001ï¼‰                          â”‚
â”‚                                                                  â”‚
â”‚  ä¸šåŠ¡éœ€æ±‚ï¼š                                                       â”‚
â”‚  âœ… å›½å†…è®¢å•èµ° ERP-Aï¼ˆç”¨å‹ï¼‰                                       â”‚
â”‚  âœ… å¤–è´¸è®¢å•èµ° ERP-Bï¼ˆSAPï¼‰                                        â”‚
â”‚  âœ… çº¸æ ·æ•°æ®ä»çº¸æ ·ç³»ç»ŸPull                                         â”‚
â”‚  âœ… ä»˜æ¬¾ç¡®è®¤é€šçŸ¥è´¢åŠ¡ç³»ç»Ÿ                                           â”‚
â”‚                                                                  â”‚
â”‚  é—®é¢˜ï¼šå¦‚ä½•åœ¨åŒä¸€ä¸ªè´¦å·ä¸‹ç®¡ç†4ä¸ªç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼Ÿ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ æŠ€æœ¯è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šåˆ›å»ºå¤šä¸ªåŒç±»å‹åº”ç”¨ï¼ˆæ¨èï¼‰

#### æ­¥éª¤1ï¼šåœ¨åº”ç”¨å•†åº—è´­ä¹°/è¯•ç”¨åº”ç”¨

```
æœè£…å‚ç®¡ç†å‘˜ç™»å½• â†’ ç³»ç»Ÿç®¡ç† â†’ åº”ç”¨å•†åº—
 â†“
è´­ä¹°"ä¸‹å•å¯¹æ¥"åº”ç”¨ï¼ˆå¯ä»¥è´­ä¹°å¤šæ¬¡ï¼Œæ¯æ¬¡åˆ›å»ºç‹¬ç«‹çš„APIå‡­è¯ï¼‰
```

#### æ­¥éª¤2ï¼šåœ¨åº”ç”¨ç®¡ç†ä¸­åˆ›å»ºå¤šä¸ªåº”ç”¨

```
ç³»ç»Ÿç®¡ç† â†’ å®¢æˆ·åº”ç”¨ç®¡ç† â†’ åº”ç”¨ç®¡ç†Tab â†’ åˆ›å»ºåº”ç”¨
```

**ç¤ºä¾‹é…ç½®**ï¼š

| åº”ç”¨åç§° | appType | appKey | ç”¨é€” | Webhookåœ°å€ |
|---------|---------|--------|------|-------------|
| **å›½å†…ERPè®¢å•** | ORDER_SYNC | os_1001_erp_a | ç”¨å‹ERPæ¨é€å›½å†…è®¢å• | http://erp-a.com/webhook |
| **å¤–è´¸ERPè®¢å•** | ORDER_SYNC | os_1001_erp_b | SAPæ¨é€å¤–è´¸è®¢å• | http://erp-b.com/webhook |
| **çº¸æ ·ç³»ç»Ÿæ‹‰å–** | ORDER_SYNC | os_1001_pattern | Pullæ¨¡å¼æ‹‰å–çº¸æ · | - |
| **ä»˜æ¬¾ç¡®è®¤** | PAYMENT_SYNC | os_1001_payment | è´¢åŠ¡ç³»ç»Ÿæ¨é€ä»˜æ¬¾è®°å½• | - |

#### æ­¥éª¤3ï¼šæ•°æ®éš”ç¦»æœºåˆ¶

**åç«¯å®ç°** (`OpenApiOrchestrator.java`)ï¼š

```java
// å½“ ERP-A è°ƒç”¨ API åˆ›å»ºè®¢å•æ—¶
order.setTenantId(1001);  // ç§Ÿæˆ·éš”ç¦»
order.setCreatedByName("OpenAPI-å›½å†…ERPè®¢å•");  // æ•°æ®æ¥æºæ ‡è®°

// å½“ ERP-B è°ƒç”¨ API åˆ›å»ºè®¢å•æ—¶
order.setTenantId(1001);  // åŒä¸€ç§Ÿæˆ·
order.setCreatedByName("OpenAPI-å¤–è´¸ERPè®¢å•");  // ä¸åŒæ¥æºæ ‡è®°
```

**æŸ¥è¯¢æ—¶è‡ªåŠ¨è¿‡æ»¤**ï¼š

```java
// æŸ¥è¯¢è®¢å•åˆ—è¡¨æ—¶ï¼Œåªè¿”å›å½“å‰ç§Ÿæˆ·çš„æ•°æ®
LambdaQueryWrapper<ProductionOrder> wrapper = new LambdaQueryWrapper<>();
wrapper.eq(ProductionOrder::getTenantId, currentTenantId)  // ç§Ÿæˆ·éš”ç¦»
       .likeRight(ProductionOrder::getCreatedByName, "OpenAPI-");  // ä»…OpenAPIåˆ›å»ºçš„è®¢å•
```

---

## ğŸ“‹ å®Œæ•´å¯¹æ¥æµç¨‹

### æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å›½å†…ERP-A   â”‚ â”€ Pushè®¢å• â”€â”€â”€â”€â”€â”€â†’ â”‚ OpenAPI Gateway               â”‚
â”‚ (ç”¨å‹)       â”‚                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ appKey:      â”‚                    â”‚ â”‚ é‰´æƒï¼š                  â”‚   â”‚
â”‚ os_1001_a    â”‚                    â”‚ â”‚ X-App-Key: os_1001_a   â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ â”‚ X-Signature: ...       â”‚   â”‚
                                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚         â”‚                    â”‚
â”‚  å¤–è´¸ERP-B   â”‚ â”€ Pushè®¢å• â”€â”€â”€â”€â”€â”€â†’ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ (SAP)        â”‚                    â”‚ â”‚ æ•°æ®æ ‡è®°ï¼š              â”‚   â”‚
â”‚ appKey:      â”‚                    â”‚ â”‚ tenantId = 1001        â”‚   â”‚
â”‚ os_1001_b    â”‚                    â”‚ â”‚ createdByName =        â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ â”‚  "OpenAPI-å›½å†…ERP"æˆ–   â”‚   â”‚
                                    â”‚ â”‚  "OpenAPI-å¤–è´¸ERP"     â”‚   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  çº¸æ ·ç³»ç»Ÿ    â”‚ â† Pullçº¸æ · â”€â”€â”€â”€â”€â”€â”€â”€ â”‚         â”‚                    â”‚
â”‚              â”‚                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ appKey:      â”‚                    â”‚ â”‚ åˆ›å»ºè®¢å•ï¼š              â”‚   â”‚
â”‚ os_1001_ptn  â”‚                    â”‚ â”‚ INSERT INTO            â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ â”‚ t_production_order     â”‚   â”‚
                                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚                              â”‚
â”‚  è´¢åŠ¡ç³»ç»Ÿ    â”‚ â”€ ç¡®è®¤ä»˜æ¬¾ â”€â”€â”€â”€â”€â”€â†’ â”‚  Webhookæ¨é€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚
â”‚              â”‚                    â”‚  (å‡ºåº“/å®Œå·¥/å®¡æ‰¹é€šçŸ¥)          â”‚
â”‚ appKey:      â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ os_1001_pay  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®åº“è®°å½•ç¤ºä¾‹

#### t_tenant_appï¼ˆAPIå‡­è¯è¡¨ï¼‰

| id | tenant_id | app_name | app_type | app_key | webhook_url | status |
|----|-----------|----------|----------|---------|-------------|--------|
| 1 | 1001 | å›½å†…ERPè®¢å• | ORDER_SYNC | os_1001_erp_a | http://erp-a.com/webhook | ACTIVE |
| 2 | 1001 | å¤–è´¸ERPè®¢å• | ORDER_SYNC | os_1001_erp_b | http://erp-b.com/webhook | ACTIVE |
| 3 | 1001 | çº¸æ ·ç³»ç»Ÿ | ORDER_SYNC | os_1001_pattern | null | ACTIVE |
| 4 | 1001 | ä»˜æ¬¾ç¡®è®¤ | PAYMENT_SYNC | os_1001_payment | null | ACTIVE |

#### t_production_orderï¼ˆç”Ÿäº§è®¢å•è¡¨ï¼‰

| id | order_no | tenant_id | created_by_name | style_no | quantity |
|----|----------|-----------|-----------------|----------|----------|
| 101 | PO20260209001 | 1001 | **OpenAPI-å›½å†…ERPè®¢å•** | FZ2024001 | 500 |
| 102 | PO20260209002 | 1001 | **OpenAPI-å¤–è´¸ERPè®¢å•** | FZ2024002 | 1000 |
| 103 | PO20260209003 | 1001 | **OpenAPI-çº¸æ ·ç³»ç»Ÿ** | FZ2024003 | 200 |

---

## ğŸ”§ åº”ç”¨ç®¡ç†ç•Œé¢æ“ä½œ

### 1. åˆ›å»ºåº”ç”¨

```
ç³»ç»Ÿç®¡ç† â†’ å®¢æˆ·åº”ç”¨ç®¡ç† â†’ åº”ç”¨ç®¡ç† Tab â†’ åˆ›å»ºåº”ç”¨

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»ºåº”ç”¨                                â”‚
â”‚                                         â”‚
â”‚  åº”ç”¨åç§°ï¼š[å›½å†…ERPè®¢å•           ]   â”‚
â”‚  åº”ç”¨ç±»å‹ï¼š[ORDER_SYNC â–¼         ]   â”‚
â”‚  Webhookï¼š[http://erp-a.com/hook ]   â”‚
â”‚  æ—¥ä¸Šé™ï¼š  [1000              æ¬¡ ]   â”‚
â”‚                                         â”‚
â”‚     [å–æ¶ˆ]          [åˆ›å»º]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ›å»ºæˆåŠŸåå¼¹çª—æ˜¾ç¤ºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… åº”ç”¨åˆ›å»ºæˆåŠŸï¼è¯·ä¿å­˜ä»¥ä¸‹å¯†é’¥           â”‚
â”‚                                         â”‚
â”‚  appKey:   os_1001_erp_a                â”‚
â”‚  appSecret: Kx9mPq2sT7vW...   [å¤åˆ¶]    â”‚
â”‚                                         â”‚
â”‚  âš ï¸ appSecret ä»…æ­¤ä¸€æ¬¡æ˜¾ç¤ºï¼Œè¯·ç«‹å³ä¿å­˜ï¼  â”‚
â”‚                                         â”‚
â”‚            [æˆ‘å·²ä¿å­˜ï¼Œå…³é—­]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æŸ¥çœ‹åº”ç”¨åˆ—è¡¨

```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚ ID  â”‚ åº”ç”¨åç§°  â”‚ ç±»å‹       â”‚ appKey   â”‚ çŠ¶æ€     â”‚ æ“ä½œâ”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ 1   â”‚å›½å†…ERPè®¢å•â”‚ ORDER_SYNC â”‚os_1001_aâ”‚ è¿è¡Œä¸­   â”‚ç¼–è¾‘ â”‚
â”‚ 2   â”‚å¤–è´¸ERPè®¢å•â”‚ ORDER_SYNC â”‚os_1001_bâ”‚ è¿è¡Œä¸­   â”‚ç¼–è¾‘ â”‚
â”‚ 3   â”‚çº¸æ ·ç³»ç»Ÿ   â”‚ ORDER_SYNC â”‚os_1001_pâ”‚ è¿è¡Œä¸­   â”‚ç¼–è¾‘ â”‚
â”‚ 4   â”‚ä»˜æ¬¾ç¡®è®¤   â”‚PAYMENT_SYNCâ”‚os_1001_yâ”‚ è¿è¡Œä¸­   â”‚ç¼–è¾‘ â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜

ç»Ÿè®¡å¡ç‰‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚åº”ç”¨æ€»æ•°  â”‚ â”‚ è¿è¡Œä¸­  â”‚ â”‚ å·²åœç”¨  â”‚ â”‚æ€»è°ƒç”¨æ¬¡æ•°â”‚
â”‚   4     â”‚ â”‚   4     â”‚ â”‚   0     â”‚ â”‚ 12,345  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. æŸ¥çœ‹APIè°ƒç”¨æ—¥å¿—

```
ç³»ç»Ÿç®¡ç† â†’ å®¢æˆ·åº”ç”¨ç®¡ç† â†’ APIæ—¥å¿— Tab

ç­›é€‰å™¨ï¼š
åº”ç”¨ï¼š[å›½å†…ERPè®¢å• â–¼]  æ—¶é—´ï¼š[æœ€è¿‘7å¤© â–¼]  çŠ¶æ€ï¼š[å…¨éƒ¨ â–¼]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¶é—´         â”‚ åº”ç”¨   â”‚ è¯·æ±‚è·¯å¾„      â”‚ æ–¹æ³•   â”‚ çŠ¶æ€ â”‚ è€—æ—¶ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ 02-09 14:32 â”‚å›½å†…ERP â”‚/orders/createâ”‚ POST   â”‚ 200  â”‚ 45ms â”‚
â”‚ 02-09 14:30 â”‚å¤–è´¸ERP â”‚/orders/createâ”‚ POST   â”‚ 200  â”‚ 38ms â”‚
â”‚ 02-09 14:25 â”‚çº¸æ ·ç³»ç»Ÿâ”‚/pull/pattern â”‚ POST   â”‚ 200  â”‚ 120msâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ å‰ç«¯ä»£ç å®ç°

### åº”ç”¨ç®¡ç†ç»„ä»¶ä½ç½®

```
frontend/src/modules/system/pages/System/TenantManagement/
â”œâ”€â”€ index.tsx               # ä¸»é¡µé¢ï¼ˆ4ä¸ªTabï¼‰
â”œâ”€â”€ OverviewTab.tsx         # å¯¹æ¥æ€»è§ˆ
â”œâ”€â”€ AppManagementTab.tsx    # åº”ç”¨ç®¡ç†ï¼ˆæ ¸å¿ƒï¼‰â­
â”œâ”€â”€ IntegrationGuideTab.tsx # ä½¿ç”¨æ•™ç¨‹
â””â”€â”€ LogTab.tsx              # APIæ—¥å¿—
```

### å…³é”®åŠŸèƒ½ä»£ç 

```tsx
// AppManagementTab.tsx

// åˆ›å»ºåº”ç”¨
const handleCreate = async () => {
  const values = await form.validateFields();
  const res = await tenantAppService.createApp(values);
  
  // æ˜¾ç¤ºå¯†é’¥å¼¹çª—ï¼ˆappSecretä»…æ­¤ä¸€æ¬¡æ˜¾ç¤ºï¼‰
  setNewSecret(res.appSecret);
  message.success('åº”ç”¨åˆ›å»ºæˆåŠŸ');
};

// é‡ç½®å¯†é’¥
const handleResetSecret = async (appId: number) => {
  Modal.confirm({
    title: 'ç¡®è®¤é‡ç½®å¯†é’¥ï¼Ÿ',
    content: 'æ—§å¯†é’¥å°†ç«‹å³å¤±æ•ˆï¼Œå¯èƒ½å¯¼è‡´ç¬¬ä¸‰æ–¹ç³»ç»Ÿè°ƒç”¨å¤±è´¥ï¼',
    onOk: async () => {
      const res = await tenantAppService.resetSecret(appId);
      setNewSecret(res.newSecret);
      message.success('å¯†é’¥é‡ç½®æˆåŠŸ');
    },
  });
};
```

---

## ğŸ” åç«¯APIå®ç°

### TenantAppOrchestrator.java

```java
@Service
public class TenantAppOrchestrator {
    
    /**
     * åˆ›å»ºç§Ÿæˆ·åº”ç”¨ï¼ˆæ”¯æŒåŒç±»å‹å¤šä¸ªï¼‰
     */
    @Transactional(rollbackFor = Exception.class)
    public TenantAppResponse createApp(Long tenantId, TenantAppRequest request) {
        // 1. ç”Ÿæˆå”¯ä¸€çš„appKeyå’ŒappSecret
        String appKey = generateAppKey(tenantId);
        String appSecret = generateAppSecret();
        String hashedSecret = hashSecret(appSecret);
        
        // 2. åˆ›å»ºTenantAppè®°å½•
        TenantApp app = new TenantApp();
        app.setTenantId(tenantId);
        app.setAppName(request.getAppName());
        app.setAppType(request.getAppType());  // å…è®¸é‡å¤
        app.setAppKey(appKey);
        app.setAppSecret(hashedSecret);
        app.setStatus("ACTIVE");
        tenantAppService.save(app);
        
        // 3. è¿”å›æ˜æ–‡å¯†é’¥ï¼ˆä»…æ­¤ä¸€æ¬¡ï¼‰
        return TenantAppResponse.builder()
            .appKey(appKey)
            .appSecret(appSecret)  // âš ï¸ æ˜æ–‡å¯†é’¥ä»…åˆ›å»ºæ—¶è¿”å›
            .build();
    }
    
    /**
     * è·å–ç§Ÿæˆ·çš„æ‰€æœ‰åº”ç”¨ï¼ˆæ”¯æŒåŒç±»å‹å¤šä¸ªï¼‰
     */
    public List<TenantApp> listApps(Long tenantId, String appType) {
        LambdaQueryWrapper<TenantApp> wrapper = new LambdaQueryWrapper<>();
        wrapper.eq(TenantApp::getTenantId, tenantId);
        if (StringUtils.hasText(appType)) {
            wrapper.eq(TenantApp::getAppType, appType);
        }
        return tenantAppService.list(wrapper);
    }
}
```

---

## ğŸ“Š æ•°æ®éš”ç¦»æœºåˆ¶è¯¦è§£

### åŒé‡è¿‡æ»¤æœºåˆ¶

```java
// OpenApiOrchestrator.java

/**
 * åˆ›å»ºå¤–éƒ¨è®¢å•ï¼ˆè‡ªåŠ¨æ ‡è®°æ•°æ®æ¥æºï¼‰
 */
public ProductionOrder createExternalOrder(String appKey, OrderRequest request) {
    // 1. é€šè¿‡appKeyè·å–TenantApp
    TenantApp app = tenantAppService.getByAppKey(appKey);
    
    // 2. åˆ›å»ºè®¢å•å¹¶æ ‡è®°
    ProductionOrder order = new ProductionOrder();
    order.setTenantId(app.getTenantId());  // âœ… ç§Ÿæˆ·éš”ç¦»
    order.setCreatedByName("OpenAPI-" + app.getAppName());  // âœ… æ¥æºæ ‡è®°
    order.setOrderNo(request.getExternalOrderNo());
    order.setStyleNo(request.getStyleNo());
    // ... å…¶ä»–å­—æ®µ
    
    productionOrderService.save(order);
    return order;
}

/**
 * æŸ¥è¯¢è®¢å•åˆ—è¡¨ï¼ˆè‡ªåŠ¨è¿‡æ»¤ç§Ÿæˆ·æ•°æ®ï¼‰
 */
public List<ProductionOrder> listOrders(String appKey, OrderQueryRequest request) {
    TenantApp app = tenantAppService.getByAppKey(appKey);
    
    LambdaQueryWrapper<ProductionOrder> wrapper = new LambdaQueryWrapper<>();
    wrapper.eq(ProductionOrder::getTenantId, app.getTenantId());  // åªè¿”å›å½“å‰ç§Ÿæˆ·
    
    // å¯é€‰ï¼šåªè¿”å›å½“å‰åº”ç”¨åˆ›å»ºçš„è®¢å•
    if (request.getOnlyMyOrders()) {
        wrapper.eq(ProductionOrder::getCreatedByName, "OpenAPI-" + app.getAppName());
    }
    
    return productionOrderService.list(wrapper);
}
```

---

## ğŸš€ å®æ–½æ­¥éª¤ï¼ˆæœè£…å‚ç®¡ç†å‘˜æ“ä½œï¼‰

### Step 1: è´­ä¹°åº”ç”¨æ¨¡å—

```bash
# ç™»å½•ç³»ç»Ÿ â†’ ç³»ç»Ÿç®¡ç† â†’ åº”ç”¨å•†åº—
1. ç‚¹å‡»"ä¸‹å•å¯¹æ¥"åº”ç”¨
2. é€‰æ‹©"ç«‹å³è´­ä¹°"æˆ–"å…è´¹è¯•ç”¨7å¤©"
3. ç¡®è®¤è´­ä¹°ï¼ˆè‡ªåŠ¨åˆ›å»ºç¬¬ä¸€ä¸ªTenantAppï¼‰
```

### Step 2: åˆ›å»ºå¤šä¸ªåº”ç”¨

```bash
# ç³»ç»Ÿç®¡ç† â†’ å®¢æˆ·åº”ç”¨ç®¡ç† â†’ åº”ç”¨ç®¡ç†Tab
1. ç‚¹å‡»"åˆ›å»ºåº”ç”¨"
2. è¾“å…¥åº”ç”¨åç§°ï¼š"å›½å†…ERPè®¢å•"
3. é€‰æ‹©ç±»å‹ï¼šORDER_SYNC
4. å¡«å†™Webhookï¼šhttp://erp-a.com/webhook
5. ä¿å­˜åè®°å½• appKey å’Œ appSecret
6. é‡å¤æ­¥éª¤1-5åˆ›å»º"å¤–è´¸ERPè®¢å•"åº”ç”¨
```

### Step 3: é…ç½®ç¬¬ä¸‰æ–¹ç³»ç»Ÿ

```bash
# ERP-A é…ç½®
APIåœ°å€ï¼šhttps://your-domain.com/openapi/v1/orders/create
appKeyï¼šos_1001_erp_a
appSecretï¼šKx9mPq2sT7vW...

# ERP-B é…ç½®
APIåœ°å€ï¼šhttps://your-domain.com/openapi/v1/orders/create
appKeyï¼šos_1001_erp_b
appSecretï¼šHy8nQr3uV9xZ...
```

### Step 4: æµ‹è¯•å¯¹æ¥

```bash
# ä»ERP-Aæ¨é€è®¢å•
curl -X POST https://your-domain.com/openapi/v1/orders/create \
  -H "X-App-Key: os_1001_erp_a" \
  -H "X-Timestamp: 1707465600000" \
  -H "X-Signature: abc123..." \
  -H "Content-Type: application/json" \
  -d '{
    "externalOrderNo": "ERP-A-001",
    "styleNo": "FZ2024001",
    "quantity": 500
  }'

# ä»ERP-Bæ¨é€è®¢å•
curl -X POST https://your-domain.com/openapi/v1/orders/create \
  -H "X-App-Key: os_1001_erp_b" \
  -H "X-Timestamp: 1707465600000" \
  -H "X-Signature: def456..." \
  -H "Content-Type: application/json" \
  -d '{
    "externalOrderNo": "ERP-B-001",
    "styleNo": "FZ2024002",
    "quantity": 1000
  }'
```

### Step 5: æŸ¥çœ‹æ•°æ®éš”ç¦»æ•ˆæœ

```sql
-- æ•°æ®åº“æŸ¥è¯¢
SELECT 
  order_no,
  created_by_name,
  style_no,
  quantity
FROM t_production_order
WHERE tenant_id = 1001;

-- ç»“æœï¼š
-- PO20260209001 | OpenAPI-å›½å†…ERPè®¢å• | FZ2024001 | 500
-- PO20260209002 | OpenAPI-å¤–è´¸ERPè®¢å• | FZ2024002 | 1000
```

---

## ğŸ“ˆ ç›‘æ§ä¸è¿ç»´

### 1. å®æ—¶ç›‘æ§ä»ªè¡¨æ¿

```
ç³»ç»Ÿç®¡ç† â†’ å®¢æˆ·åº”ç”¨ç®¡ç† â†’ é›†æˆæ€»è§ˆTab

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¹æ¥æ€»è§ˆ - å®æ—¶è¿æ¥çŠ¶æ€                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚  ğŸŸ¢ ä¸‹å•å¯¹æ¥ (2ä¸ªåº”ç”¨)                      â”‚
â”‚     â”œâ”€ å›½å†…ERPè®¢å•: è¿è¡Œä¸­ (12æ¬¡/ä»Šæ—¥)      â”‚
â”‚     â””â”€ å¤–è´¸ERPè®¢å•: è¿è¡Œä¸­ (8æ¬¡/ä»Šæ—¥)       â”‚
â”‚                                            â”‚
â”‚  ğŸŸ¢ è´¨æ£€åé¦ˆ (1ä¸ªåº”ç”¨)                      â”‚
â”‚     â””â”€ MESç³»ç»Ÿ: è¿è¡Œä¸­ (45æ¬¡/ä»Šæ—¥)          â”‚
â”‚                                            â”‚
â”‚  ğŸ”´ ç‰©æµå¯¹æ¥ (0ä¸ªåº”ç”¨)                      â”‚
â”‚     â””â”€ æœªé…ç½®                               â”‚
â”‚                                            â”‚
â”‚  ğŸŸ¢ ä»˜æ¬¾å¯¹æ¥ (1ä¸ªåº”ç”¨)                      â”‚
â”‚     â””â”€ è´¢åŠ¡ç³»ç»Ÿ: è¿è¡Œä¸­ (3æ¬¡/ä»Šæ—¥)          â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å‘Šè­¦æœºåˆ¶

```java
// WebhookPushService.java

@Scheduled(fixedDelay = 300000) // æ¯5åˆ†é’Ÿæ£€æŸ¥
public void checkWebhookHealth() {
    List<TenantApp> apps = tenantAppService.listActiveApps();
    
    for (TenantApp app : apps) {
        // æ£€æŸ¥æœ€è¿‘1å°æ—¶çš„å¤±è´¥ç‡
        long failureRate = tenantAppLogService.getFailureRate(app.getId(), 3600);
        
        if (failureRate > 0.5) { // å¤±è´¥ç‡ > 50%
            // å‘é€å‘Šè­¦é€šçŸ¥
            notificationService.sendAlert(
                app.getTenantId(),
                "åº”ç”¨ã€" + app.getAppName() + "ã€‘è°ƒç”¨å¤±è´¥ç‡è¿‡é«˜: " + (failureRate * 100) + "%"
            );
            
            // è‡ªåŠ¨ç¦ç”¨åº”ç”¨ï¼ˆå¯é€‰ï¼‰
            if (failureRate > 0.8) {
                app.setStatus("DISABLED");
                tenantAppService.updateById(app);
            }
        }
    }
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®æ¥æºæ ‡è®°è§„åˆ™

```java
// âœ… æ­£ç¡®çš„æ ‡è®°æ ¼å¼
createdByName = "OpenAPI-" + app.getAppName();
// ç¤ºä¾‹ï¼šOpenAPI-å›½å†…ERPè®¢å•

// âŒ é”™è¯¯çš„æ ‡è®°æ ¼å¼
createdByName = "ERP-A";  // æ— æ³•åŒºåˆ†æ˜¯å¦æ¥è‡ªAPI
createdByName = "1001";    // æ— æ³•æ ‡è¯†å…·ä½“åº”ç”¨
```

### 2. å¯†é’¥å®‰å…¨ç®¡ç†

```
âš ï¸ appSecret ä»…åœ¨åˆ›å»ºæ—¶æ˜¾ç¤ºä¸€æ¬¡ï¼
âœ… å»ºè®®ï¼šä½¿ç”¨å¯†ç ç®¡ç†å™¨æˆ–KMSåŠ å¯†å­˜å‚¨
âœ… å»ºè®®ï¼šå®šæœŸï¼ˆæ¯6ä¸ªæœˆï¼‰è½®æ¢å¯†é’¥
âŒ ç¦æ­¢ï¼šåœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥
âŒ ç¦æ­¢ï¼šé€šè¿‡HTTPä¼ è¾“å¯†é’¥ï¼ˆå¿…é¡»HTTPSï¼‰
```

### 3. Webhooké‡è¯•æœºåˆ¶

```java
// æ¨é€å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰
for (int retryCount = 0; retryCount < 3; retryCount++) {
    try {
        webhookClient.push(webhookUrl, data);
        break; // æˆåŠŸåˆ™é€€å‡º
    } catch (Exception e) {
        if (retryCount == 2) {
            log.error("Webhookæ¨é€å¤±è´¥ï¼ˆå·²é‡è¯•3æ¬¡ï¼‰: {}", webhookUrl);
            // è®°å½•å¤±è´¥æ—¥å¿—ï¼Œç­‰å¾…äººå·¥å¤„ç†
        }
        Thread.sleep(1000 * (retryCount + 1)); // æŒ‡æ•°é€€é¿
    }
}
```

---

## ğŸ¯ æ€»ç»“

### åº”ç”¨ç®¡ç†çš„æ ¸å¿ƒä»·å€¼

1. âœ… **å¤šåº”ç”¨éš”ç¦»**ï¼šä¸€ä¸ªç§Ÿæˆ·å¯ç®¡ç†å¤šä¸ªAPIåº”ç”¨ï¼Œå¯¹åº”ä¸åŒç¬¬ä¸‰æ–¹ç³»ç»Ÿ
2. âœ… **æ•°æ®æ¥æºè¿½è¸ª**ï¼šé€šè¿‡ `createdByName` æ ‡è®°ï¼Œæ¸…æ™°è¯†åˆ«æ•°æ®æ¥æº
3. âœ… **çµæ´»é…ç½®**ï¼šæ¯ä¸ªåº”ç”¨ç‹¬ç«‹é…ç½®Webhookã€APIåœ°å€ã€è°ƒç”¨ä¸Šé™
4. âœ… **å®‰å…¨ç®¡ç†**ï¼šå¯†é’¥éš”ç¦»ã€ç‹¬ç«‹å¯ç”¨/åœç”¨ã€è°ƒç”¨æ—¥å¿—å®¡è®¡
5. âœ… **é—®é¢˜æ’æŸ¥**ï¼šAPIæ—¥å¿—æŒ‰åº”ç”¨è¿‡æ»¤ï¼Œå¿«é€Ÿå®šä½æ•…éšœ

### å¤šç³»ç»Ÿå¯¹æ¥ä¼˜åŠ¿

| ä¼ ç»Ÿæ–¹æ¡ˆ | å½“å‰æ–¹æ¡ˆ | ä¼˜åŠ¿ |
|---------|---------|------|
| ä¸€ä¸ªappKeyå¯¹åº”æ•´ä¸ªç§Ÿæˆ· | ä¸€ä¸ªappKeyå¯¹åº”ä¸€ä¸ªåº”ç”¨ | ğŸ” å¯†é’¥æ³„éœ²å½±å“èŒƒå›´å° |
| æ— æ³•åŒºåˆ†æ•°æ®æ¥æº | createdByNameç²¾ç¡®æ ‡è®° | ğŸ“Š æ•°æ®æ¥æºå¯è¿½æº¯ |
| Webhookåœ°å€å”¯ä¸€ | æ¯ä¸ªåº”ç”¨ç‹¬ç«‹é…ç½® | ğŸ”„ æ”¯æŒå¤šç³»ç»Ÿå›è°ƒ |
| è°ƒç”¨æ—¥å¿—æ··åœ¨ä¸€èµ· | æŒ‰åº”ç”¨ç‹¬ç«‹æŸ¥è¯¢ | ğŸ› æ•…éšœæ’æŸ¥æ•ˆç‡é«˜ |

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [åº”ç”¨å•†åº—ä¸APIå¯¹æ¥å®Œæ•´æ•™ç¨‹](./åº”ç”¨å•†åº—ä¸APIå¯¹æ¥å®Œæ•´æ•™ç¨‹.md)
- [OpenAPIå¼€å‘æŒ‡å—](./OpenAPIå¼€å‘æŒ‡å—.md)
- [å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»é…ç½®æŒ‡å—](./å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»é…ç½®æŒ‡å—.md)

---

> **æ›´æ–°æ—¥æœŸ**ï¼š2026-02-09
> **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
> **ç»´æŠ¤äºº**ï¼šç³»ç»Ÿæ¶æ„ç»„
