# æ‰«ç ç³»ç»Ÿé€»è¾‘è¯¦è§£

> æœ€åæ›´æ–°ï¼š2026å¹´1æœˆ22æ—¥

## ğŸ“‹ ç›®å½•
- [æ ¸å¿ƒä¼˜åŒ–æ€»ç»“](#æ ¸å¿ƒä¼˜åŒ–æ€»ç»“)
- [æ‰«ç æµç¨‹å›¾](#æ‰«ç æµç¨‹å›¾)
- [è²å·è¯†åˆ«é€»è¾‘](#è²å·è¯†åˆ«é€»è¾‘)
- [é‡‡è´­ä»»åŠ¡é€»è¾‘](#é‡‡è´­ä»»åŠ¡é€»è¾‘)
- [è£å‰ªä»»åŠ¡é€»è¾‘](#è£å‰ªä»»åŠ¡é€»è¾‘)
- [é˜²é‡å¤æœºåˆ¶](#é˜²é‡å¤æœºåˆ¶)
- [é…ç½®ç³»ç»Ÿ](#é…ç½®ç³»ç»Ÿ)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)

---

## ğŸ¯ æ ¸å¿ƒä¼˜åŒ–æ€»ç»“

### 1. **æ™ºèƒ½å·¥åºè¯†åˆ«ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰**
**é—®é¢˜**ï¼šåŸæ¥å·¥äººéœ€æ‰‹åŠ¨åˆ‡æ¢å·¥åºï¼Œå®¹æ˜“é€‰é”™ï¼Œæ•ˆç‡ä½

**æ–¹æ¡ˆ**ï¼šæ‰«ç æ¬¡æ•°å†³å®šå·¥åº
- è²å·01ç¬¬1æ¬¡æ‰« â†’ è‡ªåŠ¨è¯†åˆ«ä¸º"åšé¢†"
- è²å·01ç¬¬2æ¬¡æ‰« â†’ è‡ªåŠ¨è¯†åˆ«ä¸º"ä¸Šé¢†"  
- è²å·01ç¬¬3æ¬¡æ‰« â†’ è‡ªåŠ¨è¯†åˆ«ä¸º"åŸ‹å¤¹"
- ...ä»¥æ­¤ç±»æ¨

**æ•ˆæœ**ï¼š
- âœ… å·¥äººæ— éœ€æ‰‹åŠ¨é€‰å·¥åºï¼Œæ‰«ç å³å¯
- âœ… é¿å…é€‰é”™å·¥åºå¯¼è‡´è®¡ä»¶é”™è¯¯
- âœ… æå‡æ‰«ç æ•ˆç‡ 50%+

---

### 2. **é˜²é‡å¤æ‰«ç ä¿æŠ¤**
**é—®é¢˜**ï¼šå·¥äººè¯¯æ‰«ã€è¿ç»­æ‰«ç å¯¼è‡´é‡å¤è®¡ä»¶

**æ–¹æ¡ˆ**ï¼šåŠ¨æ€è®¡ç®—æœ€å°é—´éš”
```javascript
æœ€å°é—´éš”æ—¶é—´ = max(30ç§’, è²å·æ•°é‡ Ã— å·¥åºé¢„è®¡åˆ†é’Ÿ Ã— 60 Ã— 50%)
```

**ç¤ºä¾‹**ï¼š
- è²å·ï¼š10ä»¶
- å·¥åºï¼šåšé¢†ï¼ˆé¢„è®¡5åˆ†é’Ÿ/ä»¶ï¼‰
- é¢„æœŸå®Œæˆæ—¶é—´ï¼š10 Ã— 5 = 50åˆ†é’Ÿ
- æœ€å°é—´éš”ï¼š50 Ã— 60 Ã— 50% = 25åˆ†é’Ÿ

åœ¨25åˆ†é’Ÿå†…é‡å¤æ‰«ç ä¼šè¢«æ‹¦æˆªï¼Œæ˜¾ç¤ºï¼š
> âš ï¸ 10ä»¶é¢„è®¡éœ€50åˆ†é’Ÿï¼Œ3åˆ†é’Ÿå‰å·²æ‰«è¿‡

**æ•ˆæœ**ï¼š
- âœ… é˜²æ­¢è¯¯æ“ä½œå¯¼è‡´é‡å¤è®¡ä»¶
- âœ… å…è®¸å¿«æ‰‹å·¥äººæå‰å®Œæˆï¼ˆ50%ç¼“å†²ï¼‰
- âœ… ä¿æŠ¤å·¥å‚åˆ©ç›Šï¼Œé¿å…è™šå‡è®¡ä»¶

---

### 3. **åŠ¨æ€å·¥åºé…ç½®**
**é—®é¢˜**ï¼šä¸åŒæ¬¾å¼å·¥åºä¸åŒï¼Œç¡¬ç¼–ç æ— æ³•é€‚åº”

**æ–¹æ¡ˆ**ï¼šä»è®¢å•å·¥è‰ºæ¨¡æ¿åŠ¨æ€è¯»å–
```javascript
// æ—§ä»£ç ï¼ˆç¡¬ç¼–ç ï¼‰
const sewingProcessList = ['åšé¢†', 'ä¸Šé¢†', 'åŸ‹å¤¹', 'å†šè„šè¾¹', 'é’‰æ‰£'];

// æ–°ä»£ç ï¼ˆåŠ¨æ€è¯»å–ï¼‰
let sewingProcessList = orderDetail.progressNodeUnitPrices
    .filter(node => node.progressStage === 'è½¦ç¼')
    .sort((a, b) => (a.sortOrder || 0) - (b.sortOrder || 0))
    .map(node => node.name);
```

**æ•ˆæœ**ï¼š
- âœ… æ”¯æŒä»»æ„æ•°é‡å·¥åºé…ç½®
- âœ… ä¸åŒè®¢å•å¯é…ç½®ä¸åŒå·¥åºæµç¨‹
- âœ… PCç«¯æ¨¡æ¿ä¸­å¿ƒç»Ÿä¸€ç®¡ç†

---

### 4. **å·¥åºæ—¶é—´é…ç½®ç•Œé¢**
**ä½ç½®**ï¼šPCç«¯ â†’ æ¨¡æ¿ä¸­å¿ƒ â†’ å·¥è‰ºæ¨¡æ¿ â†’ å·¥åºå•ä»·é…ç½®

**æ–°å¢å­—æ®µ**ï¼š`estimatedMinutes`ï¼ˆé¢„è®¡æ—¶é—´ï¼Œåˆ†é’Ÿï¼‰

**ç¤ºä¾‹é…ç½®**ï¼š
| å·¥åºåç§° | å•ä»·(å…ƒ) | é¢„è®¡æ—¶é—´(åˆ†/ä»¶) |
|---------|---------|----------------|
| åšé¢†    | 2.5     | 5              |
| ä¸Šé¢†    | 1.8     | 3              |
| åŸ‹å¤¹    | 2.0     | 4              |
| å†šè„šè¾¹  | 1.5     | 3              |
| é’‰æ‰£    | 1.0     | 2              |

**æ•ˆæœ**ï¼š
- âœ… é˜²é‡å¤æ—¶é—´æ ¹æ®å®é™…å·¥åºçµæ´»è°ƒæ•´
- âœ… å¯é€‰å­—æ®µï¼Œä¸å¡«åˆ™ä½¿ç”¨é»˜è®¤1åˆ†é’Ÿ/ä»¶
- âœ… ç®¡ç†ç«¯ç»Ÿä¸€é…ç½®ï¼Œæ‰«ç ç«¯è‡ªåŠ¨ç”Ÿæ•ˆ

---

### 5. **è²å·æ•°æ®éªŒè¯**
**é—®é¢˜**ï¼šäºŒç»´ç ä¸­çš„æ•°é‡å¯èƒ½ä¸å‡†ç¡®

**æ–¹æ¡ˆ**ï¼šä»è£å‰ªè¡¨è·å–å‡†ç¡®æ•°é‡
```javascript
// è°ƒç”¨è£å‰ªè¡¨APIéªŒè¯
const bundleInfo = await api.production.getCuttingBundle(orderNo, bundleNo);
const accurateQuantity = bundleInfo.quantity;  // ä½¿ç”¨å®˜æ–¹æ•°é‡
```

**æ•ˆæœ**ï¼š
- âœ… æ•°é‡æ¥è‡ªè£å‰ªè¡¨ï¼Œæ•°æ®å‡†ç¡®
- âœ… éªŒè¯è²å·å­˜åœ¨æ€§ï¼Œé˜²æ­¢æ‰«ææ— æ•ˆè²å·
- âœ… å¤±è´¥æ—¶é™çº§ä½¿ç”¨äºŒç»´ç æ•°é‡ï¼Œä¸å½±å“ä¸šåŠ¡

---

### 6. **ç•Œé¢ä¼˜åŒ–**
**å˜æ›´**ï¼š
1. âŒ åˆ é™¤ "ğŸ¤– è‡ªåŠ¨è¯†åˆ«å½“å‰è¿›åº¦èŠ‚ç‚¹" æç¤º
2. âœ… æ·»åŠ  ç”Ÿäº§èŠ‚ç‚¹é€‰æ‹©å™¨ï¼ˆé‡‡è´­/è£å‰ª/è½¦ç¼/å¤§çƒ«/è´¨æ£€/åŒ…è£…/å…¥åº“ï¼‰
3. âŒ åˆ é™¤ "ç¼åˆ¶(è®¡ä»¶)" è¿‡æ—¶é€‰é¡¹

**å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [è½¦ç¼ â–¼]  [æ•°é‡è¾“å…¥]  [æ‰«ç æŒ‰é’®]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**äº¤äº’**ï¼š
- é»˜è®¤è‡ªåŠ¨è¯†åˆ«ï¼Œè·³è½¬åˆ°å¯¹åº”èŠ‚ç‚¹
- è¯†åˆ«é”™è¯¯æ—¶ï¼Œç‚¹å‡»é€‰æ‹©å™¨æ‰‹åŠ¨ä¿®æ­£
- å¯åœ¨æ‰«ç å‰é¢„é€‰èŠ‚ç‚¹

---

## ğŸ”„ æ‰«ç æµç¨‹å›¾

```
ç”¨æˆ·æ‰«ç 
   â†“
è§£æäºŒç»´ç ï¼ˆè®¢å•å·ã€è²å·ã€æ•°é‡ç­‰ï¼‰
   â†“
åˆ¤æ–­ï¼šæ˜¯å¦å¯ç”¨è‡ªåŠ¨è¯†åˆ«ï¼Ÿ
   â”œâ”€ æ˜¯ â†’ æŸ¥è¯¢è®¢å•è¯¦æƒ…
   â”‚       â†“
   â”‚   åˆ¤æ–­ï¼šæ˜¯å¦åœ¨è½¦ç¼é˜¶æ®µï¼Ÿ
   â”‚       â”œâ”€ æ˜¯ï¼ˆæœ‰è²å·ï¼‰â†’ ã€è²å·è¯†åˆ«é€»è¾‘ã€‘
   â”‚       â”‚                   â†“
   â”‚       â”‚               éªŒè¯è²å·ï¼ˆè°ƒç”¨è£å‰ªè¡¨APIï¼‰
   â”‚       â”‚                   â†“
   â”‚       â”‚               æŸ¥è¯¢æ‰«ç å†å²ï¼ˆç»Ÿè®¡æ¬¡æ•°ï¼‰
   â”‚       â”‚                   â†“
   â”‚       â”‚               é˜²é‡å¤æ£€æŸ¥
   â”‚       â”‚                   â”œâ”€ é‡å¤ â†’ âš ï¸ æ‹¦æˆªï¼Œæç¤ºç­‰å¾…æ—¶é—´
   â”‚       â”‚                   â””â”€ é€šè¿‡ â†’ ç»§ç»­
   â”‚       â”‚                           â†“
   â”‚       â”‚                       æ ¹æ®æ¬¡æ•°ç¡®å®šå·¥åº
   â”‚       â”‚                           â†“
   â”‚       â”‚                       è‡ªåŠ¨åˆ‡æ¢åˆ°å¯¹åº”èŠ‚ç‚¹
   â”‚       â”‚
   â”‚       â””â”€ å¦ï¼ˆè£å‰ªåŠä¹‹å‰ï¼‰â†’ ã€è®¢å•è¯†åˆ«é€»è¾‘ã€‘
   â”‚                               â†“
   â”‚                           æ ¹æ®è®¢å•è¿›åº¦åˆ¤æ–­
   â”‚                               â†“
   â”‚                           è‡ªåŠ¨åˆ‡æ¢åˆ°å¯¹åº”èŠ‚ç‚¹
   â”‚
   â””â”€ å¦ â†’ ä½¿ç”¨æ‰‹åŠ¨é€‰æ‹©çš„èŠ‚ç‚¹
           â†“
å¼¹å‡ºç¡®è®¤å¼¹çª—
   â”œâ”€ æ˜¾ç¤ºï¼šè®¢å•å·ã€æ¬¾å·ã€æ•°é‡ã€å·¥åº
   â”œâ”€ ç”¨æˆ·å¯ä¿®æ­£èŠ‚ç‚¹é€‰æ‹©
   â””â”€ ç¡®è®¤ â†’ æäº¤æ‰«ç è®°å½•
              â†“
          ä¿å­˜åˆ°æ•°æ®åº“
              â†“
          æ›´æ–°ä»Šæ—¥ç»Ÿè®¡
              â†“
          æ˜¾ç¤ºæ‰«ç ç»“æœ
```

---

## ğŸ¯ è²å·è¯†åˆ«é€»è¾‘

### æ ¸å¿ƒç®—æ³•

```javascript
/**
 * è²å·è¯†åˆ« - æ ¹æ®æ‰«ç æ¬¡æ•°ç¡®å®šå·¥åº
 * @param {string} orderNo - è®¢å•å·
 * @param {string} bundleNo - è²å·
 * @param {number} bundleQuantity - è²å·æ•°é‡
 * @param {object} orderDetail - è®¢å•è¯¦æƒ…
 */
async detectNextStageByBundle(orderNo, bundleNo, bundleQuantity, orderDetail) {
    // 1. éªŒè¯è²å·ï¼Œè·å–å‡†ç¡®æ•°é‡
    const bundleInfo = await api.production.getCuttingBundle(orderNo, bundleNo);
    const accurateQuantity = bundleInfo.quantity;  // ä»è£å‰ªè¡¨è·å–
    
    // 2. æŸ¥è¯¢æ‰«ç å†å²
    const historyRes = await api.production.myScanHistory({
        orderNo: orderNo,
        bundleNo: bundleNo
    });
    const scanCount = historyRes.records.length;  // ç»Ÿè®¡æ¬¡æ•°
    
    // 3. è·å–å·¥åºåˆ—è¡¨ï¼ˆåŠ¨æ€ï¼‰
    let sewingProcessList = orderDetail.progressNodeUnitPrices
        .filter(node => node.progressStage === 'è½¦ç¼')
        .sort((a, b) => (a.sortOrder || 0) - (b.sortOrder || 0))
        .map(node => node.name);
    // ä¾‹å¦‚ï¼š['åšé¢†', 'ä¸Šé¢†', 'åŸ‹å¤¹', 'å†šè„šè¾¹', 'é’‰æ‰£']
    
    // 4. è·å–å·¥åºæ—¶é—´é…ç½®
    let processTimeConfig = {};  // { 'åšé¢†': 5, 'ä¸Šé¢†': 3, ... }
    orderDetail.progressNodeUnitPrices.forEach(node => {
        if (node.name && node.estimatedMinutes > 0) {
            processTimeConfig[node.name] = node.estimatedMinutes;
        }
    });
    
    // 5. é˜²é‡å¤æ£€æŸ¥
    if (scanCount > 0) {
        const lastRecord = historyRes.records[0];
        const lastScanTime = new Date(lastRecord.scanTime).getTime();
        const currentTime = Date.now();
        const timeDiff = (currentTime - lastScanTime) / 1000;  // ç§’
        
        // è®¡ç®—æœ€å°é—´éš”
        const configMinutes = processTimeConfig[lastRecord.processName] || 1;
        const expectedTime = accurateQuantity * configMinutes * 60;  // ç§’
        const minInterval = Math.max(30, expectedTime * 0.5);  // 50%ç¼“å†²
        
        if (timeDiff < minInterval) {
            // ğŸš« é‡å¤æ‰«ç ï¼Œæ‹¦æˆª
            return {
                isDuplicate: true,
                hint: `âš ï¸ ${accurateQuantity}ä»¶é¢„è®¡éœ€${Math.floor(expectedTime/60)}åˆ†é’Ÿï¼Œ${Math.floor(timeDiff/60)}åˆ†é’Ÿå‰å·²æ‰«è¿‡`
            };
        }
    }
    
    // 6. æ ¹æ®æ‰«ç æ¬¡æ•°ç¡®å®šå·¥åº
    if (scanCount < sewingProcessList.length) {
        // è¿˜åœ¨è½¦ç¼å·¥åºå†…
        const nextProcessName = sewingProcessList[scanCount];
        return {
            processName: nextProcessName,  // ä¾‹å¦‚ï¼šç¬¬0æ¬¡ â†’ 'åšé¢†'
            progressStage: 'è½¦ç¼',
            hint: `${nextProcessName} (ç¬¬${scanCount + 1}/${sewingProcessList.length}æ¬¡)`,
            quantity: accurateQuantity
        };
    } else {
        // è½¦ç¼å·¥åºéƒ½å®Œæˆï¼Œè¿›å…¥ä¸‹ä¸€é˜¶æ®µ
        return {
            processName: 'å¤§çƒ«',
            progressStage: 'å¤§çƒ«',
            hint: 'è½¦ç¼å·²å®Œæˆ'
        };
    }
}
```

---

## ï¿½ é‡‡è´­ä»»åŠ¡é€»è¾‘

### ä¸šåŠ¡æµç¨‹

é‡‡è´­ä»»åŠ¡å®ç°äº†"é¢†å–å¼€å§‹ â†’ æäº¤æ•°é‡ â†’ å®Œæˆ"çš„å®Œæ•´çŠ¶æ€æœºåˆ¶ï¼Œç¡®ä¿åŒç«¯ï¼ˆPCç«¯+å°ç¨‹åºï¼‰åŒæ­¥ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é‡‡è´­ä»»åŠ¡çŠ¶æ€æµè½¬                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  pending (å¾…é¢†å–)                                            â”‚
â”‚      â”‚                                                       â”‚
â”‚      â”œâ”€â”€â”€ PCç«¯: ç‚¹å‡»"é¢†å–" â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚      â”‚                            â”‚                          â”‚
â”‚      â””â”€â”€â”€ å°ç¨‹åº: æ‰«ç é¢†å– â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚                                    â–¼                          â”‚
â”‚                              received (å·²é¢†å–)               â”‚
â”‚                  - receiverId: é¢†å–äººID                      â”‚
â”‚                  - receiverName: é¢†å–äººå§“å                  â”‚
â”‚                  - receivedTime: é¢†å–æ—¶é—´ â† å¼€å§‹æ—¶é—´         â”‚
â”‚                                    â”‚                          â”‚
â”‚      â”œâ”€â”€â”€ PCç«¯: å¡«å†™åˆ°è´§æ•°é‡ â”€â”€â”€â”€â”¤                          â”‚
â”‚      â”‚                            â”‚                          â”‚
â”‚      â””â”€â”€â”€ å°ç¨‹åº: æäº¤æ•°é‡ â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚                                    â–¼                          â”‚
â”‚                              partial / completed             â”‚
â”‚                  - arrivedQuantity: åˆ°è´§æ•°é‡                 â”‚
â”‚                  - è‡ªåŠ¨è®¡ç®—ç‰©æ–™åˆ°è´§ç‡                        â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ä¸šåŠ¡å«ä¹‰ |
|-------|------|------|---------|
| `receiverId` | String | é¢†å–äººID | æ ‡è¯†è°é¢†å–äº†è¿™ä¸ªä»»åŠ¡ |
| `receiverName` | String | é¢†å–äººå§“å | ç”¨äºæ˜¾ç¤ºå’Œå®¡è®¡ |
| `receivedTime` | DateTime | é¢†å–æ—¶é—´ | **å¼€å§‹æ—¶é—´**ï¼Œæ ‡è®°ä»»åŠ¡å¼€å§‹æ‰§è¡Œ |
| `arrivedQuantity` | Integer | åˆ°è´§æ•°é‡ | ç´¯è®¡åˆ°è´§æ•°é‡ï¼ˆå¯åˆ†æ‰¹æäº¤ï¼‰ |
| `purchaseQuantity` | Integer | é‡‡è´­æ•°é‡ | è®¡åˆ’é‡‡è´­æ€»é‡ |
| `status` | String | çŠ¶æ€ | pending/received/partial/completed |

### å°ç¨‹åºç«¯å®ç°

**ä½ç½®**ï¼š`miniprogram/pages/scan/index.js`

#### 1. æ‰«ç é¢†å–é‡‡è´­ä»»åŠ¡
```javascript
// âœ… æ‰¹é‡æ ‡è®°é¢†å–ï¼ˆæ›´æ–° receiverId å’Œ receiverNameï¼‰
async onConfirmClaiming() {
  const materialPurchases = this.data.scanConfirm.materialPurchases || [];
  
  // ä½¿ç”¨ receivePurchase æ¥å£ï¼Œé¿å…è§¦å‘ arrivedQuantity æ ¡éªŒ
  const updates = materialPurchases.map(item => ({
    purchaseId: item.id,
    receiverId: userInfo.id,
    receiverName: userInfo.realName || userInfo.username,
  }));

  // æ‰¹é‡æ›´æ–°é¢†å–ä¿¡æ¯
  await Promise.all(updates.map(update => api.production.receivePurchase(update)));
  
  toast.success(`å·²é¢†å– ${updates.length} ä¸ªé¢æ–™é‡‡è´­ä»»åŠ¡`);
  this.loadMyProcurementTasks(); // âœ… åˆ·æ–°é‡‡è´­ä»»åŠ¡åˆ—è¡¨
}
```

#### 2. æäº¤åˆ°è´§æ•°é‡
```javascript
// âœ… æäº¤é‡‡è´­ä»»åŠ¡ï¼ˆæ¥è‡ª"æˆ‘çš„ä»»åŠ¡"åˆ—è¡¨ï¼Œåªæ›´æ–°åˆ°è´§æ•°é‡ï¼‰
async onSubmitProcurement() {
  const materialPurchases = this.data.scanConfirm.materialPurchases || [];
  
  // éªŒè¯è¾“å…¥å¹¶æ„å»ºæ›´æ–°è¯·æ±‚
  const updates = [];
  for (const item of materialPurchases) {
    const inputQty = Number(item.inputQuantity);
    if (inputQty > 0) {
      const newArrived = (Number(item.arrivedQuantity) || 0) + inputQty;
      const purchaseQty = Number(item.purchaseQuantity) || 0;
      const remark = (item.remarkInput || '').trim();

      // âš ï¸ ä¸šåŠ¡è§„åˆ™ï¼šåˆ°è´§æ•°é‡å°äº70%æ—¶å¿…é¡»å¡«å†™å¤‡æ³¨
      if (purchaseQty > 0 && newArrived * 100 < purchaseQty * 70 && !remark) {
        toast.error(`${item.materialName || 'ç‰©æ–™'}åˆ°è´§ä¸è¶³70%ï¼Œè¯·å¡«å†™å¤‡æ³¨è¯´æ˜åŸå› `);
        return;
      }

      updates.push({
        id: item.id,
        arrivedQuantity: newArrived,  // ç´¯åŠ åˆ°è´§æ•°é‡
        remark: remark,
      });
    }
  }

  // åªè°ƒç”¨ updateArrivedQuantityï¼ˆä¸å†è°ƒç”¨ receivePurchaseï¼Œå› ä¸ºå·²ç»é¢†å–äº†ï¼‰
  await Promise.all(updates.map(u => api.production.updateArrivedQuantity(u)));
  
  toast.success('æäº¤æˆåŠŸ');
  this.loadMyProcurementTasks();
}
```

### PCç«¯å®ç°

**ä½ç½®**ï¼š`frontend/src/pages/Production/MaterialPurchase.tsx`

#### é¢†å–é‡‡è´­ä»»åŠ¡
```typescript
const receivePurchaseTask = async (record: MaterialPurchaseType) => {
  const id = String(record?.id || '').trim();
  const receiverName = String(user?.name || user?.username || '').trim();

  try {
    const res = await api.post('/production/purchase/receive', {
      purchaseId: id,
      receiverId: String(user?.id || '').trim(),
      receiverName: String(receiverName).trim(),
    });
    
    if (res.code === 200) {
      message.success('å·²é¢†å–é‡‡è´­ä»»åŠ¡');
      fetchMaterialPurchaseList();  // åˆ·æ–°åˆ—è¡¨
      return;
    }
    message.error(res.message || 'é¢†å–å¤±è´¥');
  } catch (e) {
    message.error(e.message || 'é¢†å–å¤±è´¥');
  }
};
```

### åç«¯å®ç°

**ä½ç½®**ï¼š`backend/src/main/java/.../MaterialPurchaseServiceImpl.java`

#### receivePurchase() æ–¹æ³•
```java
@Override
public boolean receivePurchase(String purchaseId, String receiverId, String receiverName) {
    // 1. å‚æ•°éªŒè¯
    if (!StringUtils.hasText(purchaseId)) {
        return false;
    }
    
    // 2. æŸ¥è¯¢é‡‡è´­ä»»åŠ¡
    MaterialPurchase existed = this.getById(purchaseId);
    if (existed == null || existed.getDeleteFlag() != 0) {
        return false;
    }
    
    // 3. çŠ¶æ€æ ¡éªŒï¼šcompleted/cancelled ä¸å…è®¸é¢†å–
    String status = existed.getStatus() == null ? "" : existed.getStatus().trim();
    if ("completed".equals(status) || "cancelled".equals(status)) {
        return false;
    }
    
    // 4. pending çŠ¶æ€ â†’ æ›´æ–°ä¸º received
    if ("pending".equals(status) || !StringUtils.hasText(status)) {
        LocalDateTime now = LocalDateTime.now();
        
        LambdaUpdateWrapper<MaterialPurchase> uw = new LambdaUpdateWrapper<MaterialPurchase>()
                .eq(MaterialPurchase::getId, purchaseId)
                .eq(MaterialPurchase::getDeleteFlag, 0)
                .and(w -> w.eq(MaterialPurchase::getStatus, "pending")
                        .or().isNull(MaterialPurchase::getStatus)
                        .or().eq(MaterialPurchase::getStatus, ""))
                .set(MaterialPurchase::getReceiverId, receiverId)
                .set(MaterialPurchase::getReceiverName, receiverName)
                .set(MaterialPurchase::getReceivedTime, now)  // âœ… è®¾ç½®å¼€å§‹æ—¶é—´
                .set(MaterialPurchase::getUpdateTime, now)
                .set(MaterialPurchase::getStatus, "received");
        
        return this.update(uw);
    }
    
    // 5. å·²é¢†å– â†’ éªŒè¯æ˜¯å¦åŒä¸€ä¸ªäºº
    return isSameReceiver(existed, receiverId, receiverName);
}
```

### API æ¥å£å®šä¹‰

**å°ç¨‹åº API**ï¼š`miniprogram/utils/api.js`
```javascript
production: {
  // é¢†å–é‡‡è´­ä»»åŠ¡
  receivePurchase(payload) {
    return ok('/api/production/purchase/receive', 'POST', payload || {});
  },
  
  // æ›´æ–°åˆ°è´§æ•°é‡
  updateArrivedQuantity(payload) {
    return ok('/api/production/purchase/update-arrived-quantity', 'POST', payload || {});
  },
  
  // è·å–æˆ‘çš„é‡‡è´­ä»»åŠ¡
  myProcurementTasks() {
    return ok('/api/production/purchase/my-tasks', 'GET', {});
  },
}
```

### ä¸šåŠ¡è§„åˆ™

#### 1. é¢†å–è§„åˆ™
- âœ… åªæœ‰ `pending` çŠ¶æ€çš„ä»»åŠ¡å¯ä»¥é¢†å–
- âœ… é¢†å–æ—¶è‡ªåŠ¨è®°å½• `receivedTime`ï¼ˆå¼€å§‹æ—¶é—´ï¼‰
- âœ… å·²å®Œæˆï¼ˆcompletedï¼‰æˆ–å·²å–æ¶ˆï¼ˆcancelledï¼‰çš„ä»»åŠ¡ä¸å…è®¸é¢†å–
- âœ… å·²é¢†å–çš„ä»»åŠ¡ï¼Œç›¸åŒé¢†å–äººå¯é‡å¤è°ƒç”¨ï¼ˆå¹‚ç­‰æ€§ï¼‰

#### 2. åˆ°è´§è§„åˆ™
- âœ… åˆ°è´§æ•°é‡å¯åˆ†æ‰¹æäº¤ï¼ˆç´¯åŠ ï¼‰
- âœ… åˆ°è´§ä¸è¶³70%æ—¶å¿…é¡»å¡«å†™å¤‡æ³¨è¯´æ˜åŸå› 
- âš ï¸ åˆ°è´§æ•°é‡ä¸èƒ½è¶…è¿‡é‡‡è´­æ•°é‡
- âœ… æ¯æ¬¡æäº¤è‡ªåŠ¨æ›´æ–°è®¢å•çš„ç‰©æ–™åˆ°è´§ç‡

#### 3. çŠ¶æ€è½¬æ¢
```
pending â†’ received â†’ partial â†’ completed
   â†“                              â†‘
cancelled â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

- `pending`: å¾…é¢†å–
- `received`: å·²é¢†å–ï¼ˆ`receivedTime` ä¸ä¸ºç©ºï¼‰
- `partial`: éƒ¨åˆ†åˆ°è´§ï¼ˆ0 < arrivedQuantity < purchaseQuantityï¼‰
- `completed`: å…¨éƒ¨åˆ°è´§ï¼ˆarrivedQuantity >= purchaseQuantityï¼‰
- `cancelled`: å·²å–æ¶ˆ

### åŒç«¯åŒæ­¥æœºåˆ¶

#### æ•°æ®ä¸€è‡´æ€§ä¿è¯
1. **é¢†å–åŒæ­¥**
   - PCç«¯é¢†å– â†’ åç«¯æ›´æ–° `receivedTime` â†’ å°ç¨‹åºåˆ·æ–°æ˜¾ç¤ºå·²é¢†å–
   - å°ç¨‹åºé¢†å– â†’ åç«¯æ›´æ–° `receivedTime` â†’ PCç«¯åˆ·æ–°æ˜¾ç¤ºå·²é¢†å–

2. **æäº¤åŒæ­¥**
   - PCç«¯æäº¤æ•°é‡ â†’ åç«¯ç´¯åŠ  `arrivedQuantity` â†’ å°ç¨‹åºæ˜¾ç¤ºæœ€æ–°æ•°é‡
   - å°ç¨‹åºæäº¤ â†’ åç«¯ç´¯åŠ  `arrivedQuantity` â†’ PCç«¯æ˜¾ç¤ºæœ€æ–°æ•°é‡

3. **ç‰©æ–™åˆ°è´§ç‡åŒæ­¥**
   - æ¯æ¬¡æäº¤åˆ°è´§æ•°é‡ â†’ åç«¯è‡ªåŠ¨é‡ç®—è®¢å•ç‰©æ–™åˆ°è´§ç‡
   - è®¢å•è¯¦æƒ…é¡µå®æ—¶æ˜¾ç¤ºæœ€æ–°åˆ°è´§ç‡

#### å®æ—¶åˆ·æ–°ç­–ç•¥
- âœ… å°ç¨‹åºï¼šæäº¤åè°ƒç”¨ `loadMyProcurementTasks()` åˆ·æ–°åˆ—è¡¨
- âœ… PCç«¯ï¼šæäº¤åè°ƒç”¨ `fetchMaterialPurchaseList()` åˆ·æ–°è¡¨æ ¼
- âœ… è®¢å•åˆ—è¡¨ï¼šç‰©æ–™åˆ°è´§ç‡å®æ—¶æ›´æ–°ï¼ˆé€šè¿‡åç«¯ Orchestrator è”åŠ¨ï¼‰

---

## ğŸ“‹ è£å‰ªä»»åŠ¡é€»è¾‘

### å®Œæˆåˆ¤æ–­è§„åˆ™ï¼ˆv2.1 ä¼˜åŒ–ï¼‰

è£å‰ªä»»åŠ¡ä»åŸæ¥çš„"æœ‰è²å·æ•°é‡å³è§†ä¸ºå®Œæˆ"æ”¹ä¸º**ä¸¥æ ¼ä¸‰æ¡ä»¶åˆ¤æ–­**ã€‚

#### å®Œæˆæ¡ä»¶ï¼ˆå¿…é¡»åŒæ—¶æ»¡è¶³ï¼‰

```java
// âœ… æ¡ä»¶1ï¼šå·²é¢†å–ï¼ˆreceived_time ä¸ä¸ºç©ºï¼‰
boolean hasReceivedTime = cuttingTask.receivedTime != null;

// âœ… æ¡ä»¶2ï¼šå·²ç”Ÿæˆè²å·ï¼ˆbundled_time ä¸ä¸ºç©ºï¼‰
boolean hasBundledTime = cuttingTask.bundledTime != null;

// âœ… æ¡ä»¶3ï¼šçŠ¶æ€ä¸ºå®Œæˆ
boolean isStatusCompleted = ["completed", "bundled", "done"]
    .includes(cuttingTask.status.toLowerCase());

// âœ… æœ€ç»ˆåˆ¤æ–­
boolean isCuttingCompleted = hasReceivedTime && hasBundledTime && isStatusCompleted;
```

#### å…³é”®å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ä¸šåŠ¡å«ä¹‰ |
|-------|------|------|---------|
| `receivedTime` | DateTime | é¢†å–æ—¶é—´ | PCç«¯/æ‰«ç é¢†å–å¼€å§‹è£å‰ªçš„æ—¶é—´ |
| `bundledTime` | DateTime | è²å·ç”Ÿæˆæ—¶é—´ | ä¸€é”®å¯¼å…¥è²å·/æ‰‹æœºç”Ÿæˆè²å·çš„æ—¶é—´ |
| `status` | String | çŠ¶æ€ | pending/received/bundled/completed/done |

### å°ç¨‹åºç«¯æ£€æŸ¥é€»è¾‘

**ä½ç½®**ï¼š`miniprogram/pages/scan/services/StageDetector.js`

```javascript
/**
 * æ£€æŸ¥è£å‰ªä»»åŠ¡æ˜¯å¦å®Œæˆ
 * @private
 * @param {Object} orderDetail - è®¢å•è¯¦æƒ…
 * @returns {boolean} - æ˜¯å¦å®Œæˆ
 */
_checkCuttingCompleted(orderDetail) {
  const cuttingTask = orderDetail.cuttingTask || {};
  
  // âœ… æ¡ä»¶1ï¼šè²å·å·²ç”Ÿæˆ
  const hasBundledTime = !!cuttingTask.bundledTime;
  
  // âœ… æ¡ä»¶2ï¼šå·²é¢†å–
  const hasReceivedTime = !!cuttingTask.receivedTime;
  
  // âœ… æ¡ä»¶3ï¼šçŠ¶æ€ä¸ºå®Œæˆ
  const isStatusCompleted = ['completed', 'bundled', 'done'].includes(
    (cuttingTask.status || '').toLowerCase()
  );
  
  // âš ï¸ å¿…é¡»æ»¡è¶³ï¼šå·²é¢†å– + å·²ç”Ÿæˆè²å·
  return hasBundledTime && (hasReceivedTime || isStatusCompleted);
}

/**
 * å¤„ç†æ–°è®¢å•çš„é˜¶æ®µæ£€æµ‹
 */
_handleNewOrder(orderDetail) {
  const materialArrivalRate = orderDetail.materialArrivalRate || 0;
  const isCuttingCompleted = this._checkCuttingCompleted(orderDetail);
  
  // æƒ…å†µ1ï¼šç‰©æ–™æœªåˆ°é½ï¼ˆ<100%ï¼‰â†’ å¿…é¡»åœç•™åœ¨é‡‡è´­é˜¶æ®µ
  if (materialArrivalRate < 100) {
    return {
      processName: 'é‡‡è´­',
      progressStage: 'é‡‡è´­',
      scanType: 'procurement',
      hint: 'ç‰©æ–™æœªåˆ°é½ï¼Œè¯·å®Œæˆé‡‡è´­åå†æ‰«ç ',
    };
  }
  
  // æƒ…å†µ2ï¼šç‰©æ–™å·²åˆ°é½ï¼Œä½†è£å‰ªæœªå®Œæˆ â†’ åœç•™åœ¨è£å‰ªé˜¶æ®µ
  if (materialArrivalRate >= 100 && !isCuttingCompleted) {
    return {
      processName: 'è£å‰ª',
      progressStage: 'è£å‰ª',
      scanType: 'cutting',
      hint: 'è£å‰ªè¿›è¡Œä¸­ï¼Œè¯·å…ˆå®Œæˆè²å·ç”Ÿæˆ',
    };
  }
  
  // æƒ…å†µ3ï¼šç‰©æ–™å·²åˆ°é½ï¼Œè£å‰ªå·²å®Œæˆ â†’ è¿›å…¥è½¦ç¼
  return {
    processName: 'è½¦ç¼',
    progressStage: 'è½¦ç¼',
    scanType: 'sewing',
    hint: 'å¯ä»¥å¼€å§‹è½¦ç¼æ‰«ç ',
  };
}
```

### åç«¯å®ç°

**ä½ç½®**ï¼š`backend/.../ProductionOrderQueryService.java`

#### å¡«å……è£å‰ªä»»åŠ¡è¯¦æƒ…
```java
/**
 * å¡«å……è£å‰ªæ±‡æ€»ä¿¡æ¯ï¼ˆåŒ…å«ä»»åŠ¡è¯¦æƒ…ï¼‰
 */
private void fillCuttingSummary(ProductionOrder order) {
    if (order == null) return;
    
    String oid = order.getId();
    if (!StringUtils.hasText(oid)) return;
    
    // 1. æŸ¥è¯¢è£å‰ªä»»åŠ¡ï¼ˆè·å– receivedTime, bundledTime, statusï¼‰
    LambdaQueryWrapper<CuttingTask> taskWrapper = new LambdaQueryWrapper<CuttingTask>()
            .eq(CuttingTask::getOrderId, oid)
            .eq(CuttingTask::getDeleteFlag, 0)
            .last("LIMIT 1");
    
    CuttingTask task = cuttingTaskMapper.selectOne(taskWrapper);
    
    // 2. å¡«å……ä»»åŠ¡è¯¦æƒ…åˆ°è®¢å•å¯¹è±¡
    if (task != null) {
        order.setCuttingTask(task);  // âœ… åŒ…å« receivedTime, bundledTime, status
    }
    
    // 3. æŸ¥è¯¢è²å·æ±‡æ€»ï¼ˆæ•°é‡ã€æ‰æ•°ï¼‰
    // ...
}
```

### ä¸šåŠ¡å½±å“

#### âŒ ä¿®å¤å‰ï¼ˆæ—§é€»è¾‘ï¼‰
```
é—®é¢˜ï¼šåªè¦æœ‰è£å‰ªä»»åŠ¡è®°å½•ï¼Œå°±è®¤ä¸ºè£å‰ªå®Œæˆ
ç»“æœï¼šç‰©æ–™æœªåˆ°é½ + åˆ›å»ºäº†è£å‰ªä»»åŠ¡ â†’ é”™è¯¯è¿›å…¥è½¦ç¼é˜¶æ®µ
```

#### âœ… ä¿®å¤åï¼ˆæ–°é€»è¾‘ï¼‰
```
è§„åˆ™ï¼šå¿…é¡»åŒæ—¶æ»¡è¶³ï¼š
  1. å·²é¢†å–ï¼ˆreceivedTimeï¼‰
  2. å·²ç”Ÿæˆè²å·ï¼ˆbundledTimeï¼‰
  3. çŠ¶æ€å®Œæˆï¼ˆcompleted/bundled/doneï¼‰
  
ç»“æœï¼šç‰©æ–™87% + è£å‰ªpending â†’ æ­£ç¡®åœç•™åœ¨é‡‡è´­é˜¶æ®µ
```

### ç›¸å…³ API

**åç«¯æ¥å£**ï¼š
- `GET /api/production/order/detail/{id}` - è®¢å•è¯¦æƒ…ï¼ˆåŒ…å« `cuttingTask` å­—æ®µï¼‰
- `POST /api/production/cutting/receive` - é¢†å–è£å‰ªä»»åŠ¡
- `POST /api/production/cutting/generate-bundles` - ç”Ÿæˆè²å·

**è¿”å›ç¤ºä¾‹**ï¼š
```json
{
  "orderNo": "PO20260124001",
  "materialArrivalRate": 87,
  "cuttingTask": {
    "receivedTime": null,
    "bundledTime": null,
    "status": "pending"
  }
}
```

---

## ï¿½ğŸ›¡ï¸ é˜²é‡å¤æœºåˆ¶

### æ—¶é—´è®¡ç®—å…¬å¼

```
é¢„æœŸå®Œæˆæ—¶é—´(ç§’) = è²å·æ•°é‡ Ã— å·¥åºé¢„è®¡æ—¶é—´(åˆ†) Ã— 60
æœ€å°é—´éš”æ—¶é—´(ç§’) = max(30, é¢„æœŸå®Œæˆæ—¶é—´ Ã— 50%)
```

### å®ä¾‹æ¼”ç®—

**åœºæ™¯1ï¼šæ­£å¸¸é€Ÿåº¦**
```
è²å·ï¼š20ä»¶
å·¥åºï¼šä¸Šé¢†ï¼ˆé…ç½®3åˆ†é’Ÿ/ä»¶ï¼‰
é¢„æœŸæ—¶é—´ï¼š20 Ã— 3 = 60åˆ†é’Ÿ
æœ€å°é—´éš”ï¼š60 Ã— 60 Ã— 50% = 30åˆ†é’Ÿ

ç¬¬1æ¬¡æ‰«ç  â†’ 9:00 âœ… è®°å½•
ç¬¬2æ¬¡æ‰«ç  â†’ 9:15 âŒ æ‹¦æˆªï¼ˆä»…è¿‡15åˆ†é’Ÿï¼‰
ç¬¬2æ¬¡æ‰«ç  â†’ 9:35 âœ… è®°å½•ï¼ˆè¿‡äº†35åˆ†é’Ÿï¼‰
```

**åœºæ™¯2ï¼šå¿«æ‰‹å·¥äºº**
```
è²å·ï¼š10ä»¶
å·¥åºï¼šé’‰æ‰£ï¼ˆé…ç½®2åˆ†é’Ÿ/ä»¶ï¼‰
é¢„æœŸæ—¶é—´ï¼š10 Ã— 2 = 20åˆ†é’Ÿ
æœ€å°é—´éš”ï¼š20 Ã— 60 Ã— 50% = 10åˆ†é’Ÿ

å®é™…ç”¨æ—¶ï¼š12åˆ†é’Ÿ âœ… é€šè¿‡ï¼ˆå¤§äº10åˆ†é’Ÿï¼‰
```

**åœºæ™¯3ï¼šå°æ‰¹é‡**
```
è²å·ï¼š3ä»¶
å·¥åºï¼šåšé¢†ï¼ˆé…ç½®5åˆ†é’Ÿ/ä»¶ï¼‰
é¢„æœŸæ—¶é—´ï¼š3 Ã— 5 = 15åˆ†é’Ÿ
æœ€å°é—´éš”ï¼šmax(30, 15Ã—60Ã—50%) = 30ç§’ï¼ˆä½¿ç”¨æœ€å°å€¼ï¼‰

å®é™…ç”¨æ—¶ï¼š40ç§’ âœ… é€šè¿‡
```

### æ‹¦æˆªæç¤ºæ ·å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ 20ä»¶é¢„è®¡éœ€60åˆ†é’Ÿï¼Œ15åˆ†é’Ÿå‰   â”‚
â”‚     å·²æ‰«è¿‡                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ é…ç½®ç³»ç»Ÿ

### PCç«¯é…ç½®è·¯å¾„
```
ç™»å½•PCç®¡ç†ç«¯
 â†’ æ¨¡æ¿ä¸­å¿ƒ
   â†’ å·¥è‰ºæ¨¡æ¿
     â†’ é€‰æ‹©æ¨¡æ¿
       â†’ å·¥åºå•ä»·é…ç½®
         â†’ æ·»åŠ /ç¼–è¾‘å·¥åº
           â”œâ”€ å·¥åºåç§°ï¼šåšé¢†
           â”œâ”€ å•ä»·ï¼š2.5å…ƒ
           â””â”€ é¢„è®¡æ—¶é—´ï¼š5åˆ†é’Ÿ â¬…ï¸ æ–°å¢å­—æ®µ
```

### é…ç½®ç¤ºä¾‹

**è¡¬è¡«å·¥è‰ºæ¨¡æ¿**
```json
{
  "templateName": "è¡¬è¡«æ ‡å‡†å·¥è‰º",
  "steps": [
    {
      "progressStage": "è½¦ç¼",
      "processName": "åšé¢†",
      "unitPrice": 2.5,
      "estimatedMinutes": 5,
      "sortOrder": 1
    },
    {
      "progressStage": "è½¦ç¼",
      "processName": "ä¸Šé¢†",
      "unitPrice": 1.8,
      "estimatedMinutes": 3,
      "sortOrder": 2
    },
    {
      "progressStage": "è½¦ç¼",
      "processName": "åŸ‹å¤¹",
      "unitPrice": 2.0,
      "estimatedMinutes": 4,
      "sortOrder": 3
    },
    {
      "progressStage": "è½¦ç¼",
      "processName": "é’‰æ‰£",
      "unitPrice": 1.0,
      "estimatedMinutes": 2,
      "sortOrder": 4
    }
  ]
}
```

**Tæ¤å·¥è‰ºæ¨¡æ¿**ï¼ˆç®€åŒ–ç‰ˆï¼‰
```json
{
  "templateName": "Tæ¤ç®€æ˜“å·¥è‰º",
  "steps": [
    {
      "progressStage": "è½¦ç¼",
      "processName": "è½¦é¢†",
      "unitPrice": 1.5,
      "estimatedMinutes": 2,
      "sortOrder": 1
    },
    {
      "progressStage": "è½¦ç¼",
      "processName": "è½¦è¢–",
      "unitPrice": 1.2,
      "estimatedMinutes": 2,
      "sortOrder": 2
    },
    {
      "progressStage": "è½¦ç¼",
      "processName": "è½¦è¾¹",
      "unitPrice": 1.0,
      "estimatedMinutes": 1,
      "sortOrder": 3
    }
  ]
}
```

### æ•°æ®æµè½¬

```
PCç«¯é…ç½®
    â†“
ä¿å­˜åˆ° t_template_library è¡¨
    â†“
è®¢å•å¼•ç”¨æ¨¡æ¿
    â†“
å­˜å‚¨åˆ° t_production_order.progressNodeUnitPrices (JSON)
    â†“
å°ç¨‹åºæŸ¥è¯¢è®¢å•è¯¦æƒ…
    â†“
orderDetail.progressNodeUnitPrices æ•°ç»„
    â†“
åŠ¨æ€ç”Ÿæˆå·¥åºåˆ—è¡¨å’Œæ—¶é—´é…ç½®
    â†“
ç”¨äºæ‰«ç è¯†åˆ«å’Œé˜²é‡å¤è®¡ç®—
```

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### å‰ç«¯ï¼ˆå°ç¨‹åºï¼‰
**æ–‡ä»¶**ï¼š`miniprogram/pages/scan/index.js`

**æ ¸å¿ƒæ–¹æ³•**ï¼š
- `detectNextStageByBundle()` - è²å·è¯†åˆ«é€»è¾‘
- `onScan()` - æ‰«ç å…¥å£ï¼Œåè°ƒå„æ¨¡å—
- `onConfirmScan()` - æäº¤æ‰«ç è®°å½•

**å…³é”®æ•°æ®ç»“æ„**ï¼š
```javascript
{
  scanTypeOptions: [
    { label: 'é‡‡è´­', value: 'procurement', progressStage: 'é‡‡è´­' },
    { label: 'è£å‰ª', value: 'cutting', progressStage: 'è£å‰ª' },
    { label: 'è½¦ç¼', value: 'production', progressStage: 'è½¦ç¼' },
    { label: 'å¤§çƒ«', value: 'production', progressStage: 'å¤§çƒ«' },
    { label: 'è´¨æ£€', value: 'quality', progressStage: 'è´¨æ£€' },
    { label: 'åŒ…è£…', value: 'production', progressStage: 'åŒ…è£…' },
    { label: 'å…¥åº“', value: 'warehouse' }
  ]
}
```

### åç«¯ API

**è®¢å•è¯¦æƒ…**ï¼š
```
GET /api/production/order/detail/{id}

è¿”å›ï¼š
{
  "orderNo": "PO20260122001",
  "currentProgressName": "è½¦ç¼",
  "progressNodeUnitPrices": [
    {
      "progressStage": "è½¦ç¼",
      "name": "åšé¢†",
      "unitPrice": 2.5,
      "estimatedMinutes": 5,
      "sortOrder": 1
    },
    ...
  ]
}
```

**æ‰«ç å†å²**ï¼š
```
GET /api/production/scan/my-history
å‚æ•°ï¼š{ orderNo, bundleNo }

è¿”å›ï¼š
{
  "records": [
    {
      "scanTime": "2026-01-22 09:00:00",
      "processName": "åšé¢†",
      "quantity": 20
    }
  ]
}
```

**è£å‰ªè²å·æŸ¥è¯¢**ï¼š
```
GET /api/production/cutting/by-no
å‚æ•°ï¼š{ orderNo, bundleNo }

è¿”å›ï¼š
{
  "bundleNo": "01",
  "quantity": 20,
  "qrCode": "PO20260122001-01-20",
  "status": "completed"
}
```

### æ•°æ®åº“è¡¨

**æ‰«ç è®°å½•**ï¼š`t_scan_record`
```sql
CREATE TABLE t_scan_record (
  id BIGINT PRIMARY KEY,
  production_order_no VARCHAR(50),
  bundle_no VARCHAR(20),          -- è²å·
  scan_code VARCHAR(200),
  scan_type VARCHAR(20),
  progress_stage VARCHAR(50),
  process_name VARCHAR(100),      -- å·¥åºåç§°
  quantity INT,
  scan_time DATETIME,
  user_id BIGINT,
  INDEX idx_order_bundle (production_order_no, bundle_no),
  INDEX idx_scan_time (scan_time)
);
```

**è£å‰ªè²å·**ï¼š`t_cutting_bundle`
```sql
CREATE TABLE t_cutting_bundle (
  id BIGINT PRIMARY KEY,
  production_order_no VARCHAR(50),
  bundle_no VARCHAR(20),          -- è²å·
  quantity INT,                   -- å‡†ç¡®æ•°é‡
  qr_code VARCHAR(200),
  status VARCHAR(20),
  create_time DATETIME,
  UNIQUE KEY uk_order_bundle (production_order_no, bundle_no)
);
```

---

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### ä¼˜åŒ–å‰
```
å·¥äººæ“ä½œæµç¨‹ï¼š
1. æ‰‹åŠ¨é€‰æ‹©å·¥åºï¼ˆåšé¢†ï¼‰
2. æ‰«ç 
3. è¾“å…¥æ•°é‡
4. æäº¤
   â†“
ä¸‹ä¸€ä¸ªè²å·ï¼š
1. æ‰‹åŠ¨åˆ‡æ¢å·¥åºï¼ˆä¸Šé¢†ï¼‰â† å®¹æ˜“å¿˜è®°/é€‰é”™
2. æ‰«ç 
3. è¾“å…¥æ•°é‡
4. æäº¤

é—®é¢˜ï¼š
âŒ æ¯æ¬¡éƒ½è¦æ‰‹åŠ¨åˆ‡æ¢å·¥åº
âŒ å®¹æ˜“é€‰é”™å¯¼è‡´è®¡ä»¶é”™è¯¯
âŒ å¯ä»¥è¿ç»­æ‰«ç åˆ·å•
âŒ å·¥åºåˆ—è¡¨å†™æ­»ï¼Œä¸çµæ´»
```

### ä¼˜åŒ–å
```
å·¥äººæ“ä½œæµç¨‹ï¼š
1. æ‰«ç  â†’ è‡ªåŠ¨è¯†åˆ«"åšé¢†"
2. è‡ªåŠ¨å¡«å……æ•°é‡
3. ç¡®è®¤æäº¤
   â†“
ä¸‹ä¸€ä¸ªè²å·ï¼ˆåŒè®¢å•ï¼‰ï¼š
1. æ‰«ç  â†’ è‡ªåŠ¨è¯†åˆ«"ä¸Šé¢†" â† è‡ªåŠ¨åˆ‡æ¢ï¼
2. è‡ªåŠ¨å¡«å……æ•°é‡
3. ç¡®è®¤æäº¤

ä¼˜åŠ¿ï¼š
âœ… å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨é€‰æ‹©
âœ… æ ¹æ®æ‰«ç æ¬¡æ•°ç²¾å‡†è¯†åˆ«å·¥åº
âœ… åŠ¨æ€é˜²é‡å¤ï¼Œé¿å…åˆ·å•
âœ… å·¥åºé…ç½®åŒ–ï¼Œæ”¯æŒä»»æ„æµç¨‹
âœ… æ•°æ®å‡†ç¡®æ€§æå‡ï¼ˆä»è£å‰ªè¡¨è·å–ï¼‰
```

---

## ğŸ“ ä½¿ç”¨å»ºè®®

### ç®¡ç†å‘˜é…ç½®æŒ‡å—
1. **åˆ›å»ºå·¥è‰ºæ¨¡æ¿**ï¼ˆPCç«¯ â†’ æ¨¡æ¿ä¸­å¿ƒï¼‰
   - æŒ‰å®é™…å·¥åºé¡ºåºæ·»åŠ 
   - é…ç½®åˆç†çš„å•ä»·
   - å¡«å†™é¢„è®¡æ—¶é—´ï¼ˆå¯é€‰ï¼Œå»ºè®®å¡«å†™ï¼‰

2. **è®¢å•ç»‘å®šæ¨¡æ¿**
   - ä¸‹å•æ—¶é€‰æ‹©å¯¹åº”å·¥è‰ºæ¨¡æ¿
   - ç³»ç»Ÿè‡ªåŠ¨ç»§æ‰¿å·¥åºé…ç½®

3. **ç›‘æ§é˜²é‡å¤æ•ˆæœ**
   - è§‚å¯Ÿæ‰«ç è®°å½•ï¼Œæ˜¯å¦æœ‰å¼‚å¸¸å¯†é›†æ‰«ç 
   - æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´å·¥åºé¢„è®¡æ—¶é—´

### å·¥äººä½¿ç”¨æŒ‡å—
1. **é¦–æ¬¡æ‰«ç **
   - ç¡®ä¿é€‰æ‹©å™¨åœ¨"è½¦ç¼"èŠ‚ç‚¹
   - æ‰«æè²å·äºŒç»´ç 
   - ç¡®è®¤å·¥åºå’Œæ•°é‡ï¼Œæäº¤

2. **åç»­æ‰«ç ï¼ˆåŒè²å·ï¼‰**
   - ç›´æ¥æ‰«ç å³å¯
   - ç³»ç»Ÿè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå·¥åº
   - å¦‚æç¤º"é‡å¤æ‰«ç "ï¼Œè¯´æ˜æ—¶é—´æœªåˆ°ï¼Œç­‰å¾…åå†æ‰«

3. **æ‰‹åŠ¨ä¿®æ­£**
   - å¦‚è‡ªåŠ¨è¯†åˆ«é”™è¯¯ï¼Œç‚¹å‡»èŠ‚ç‚¹é€‰æ‹©å™¨ä¿®æ”¹
   - é€‚ç”¨äºè·³è¿‡æŸä¸ªå·¥åºç­‰ç‰¹æ®Šæƒ…å†µ

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### Q1ï¼šæ‰«ç åæ²¡æœ‰è‡ªåŠ¨åˆ‡æ¢å·¥åº
**æ’æŸ¥**ï¼š
1. æ£€æŸ¥è®¢å•æ˜¯å¦ç»‘å®šäº†å·¥è‰ºæ¨¡æ¿
2. æ£€æŸ¥å·¥åºé…ç½®ä¸­ `progressStage` æ˜¯å¦ä¸º"è½¦ç¼"
3. æ£€æŸ¥è²å·æ˜¯å¦å­˜åœ¨äºè£å‰ªè¡¨

### Q2ï¼šé˜²é‡å¤ä¸€ç›´æ‹¦æˆª
**æ’æŸ¥**ï¼š
1. æ£€æŸ¥å·¥åºé¢„è®¡æ—¶é—´é…ç½®æ˜¯å¦è¿‡å¤§
2. æ£€æŸ¥è²å·æ•°é‡æ˜¯å¦æ­£ç¡®
3. å¯ä¸´æ—¶é€šè¿‡æ‰‹åŠ¨é€‰æ‹©å™¨åˆ‡æ¢åˆ°ä¸‹ä¸€å·¥åº

### Q3ï¼šå·¥åºé¡ºåºé”™ä¹±
**æ’æŸ¥**ï¼š
1. æ£€æŸ¥æ¨¡æ¿é…ç½®ä¸­çš„ `sortOrder` å­—æ®µ
2. ç¡®ä¿ `sortOrder` æŒ‰ 1,2,3... é€’å¢
3. é‡æ–°ä¿å­˜æ¨¡æ¿ç”Ÿæ•ˆ

---

## ğŸ“ ç‰ˆæœ¬å†å²

**v2.1** - 2026å¹´1æœˆ25æ—¥
- âœ… **è£å‰ªå®Œæˆåˆ¤æ–­é€»è¾‘ä¼˜åŒ–**ï¼ˆæ ¸å¿ƒä¸šåŠ¡è§„åˆ™ä¿®æ”¹ï¼‰
  - ä»åŸæ¥çš„"æœ‰è²å·æ•°é‡å³è§†ä¸ºå®Œæˆ"æ”¹ä¸ºä¸¥æ ¼ä¸‰æ¡ä»¶åˆ¤æ–­
  - **æ–°è§„åˆ™**ï¼šåªæœ‰åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ‰ç®—è£å‰ªå®Œæˆï¼Œå¯è¿›å…¥è½¦ç¼ï¼š
    1. âœ… è£å‰ªä»»åŠ¡å·²é¢†å–ï¼ˆ`received_time` ä¸ä¸ºç©ºï¼‰
    2. âœ… è²å·å·²ç”Ÿæˆï¼ˆ`bundled_time` ä¸ä¸ºç©ºï¼‰
    3. âœ… çŠ¶æ€ä¸º `completed/bundled/done`
  - åç«¯è¿”å› `cuttingTask` è¯¦æƒ…ï¼ˆåŒ…å« `receivedTime`, `bundledTime`, `status`ï¼‰
  - å°ç¨‹åºç«¯é€šè¿‡ `orderDetail.cuttingTask.bundledTime` ç²¾å‡†åˆ¤æ–­
  - **å½±å“**ï¼šä¿®å¤äº†ç‰©æ–™æœªåˆ°é½ä½†å·²åˆ›å»ºè£å‰ªä»»åŠ¡å¯¼è‡´é”™è¯¯è·³åˆ°è½¦ç¼çš„é—®é¢˜

**v2.0** - 2026å¹´1æœˆ22æ—¥
- âœ… å®ç°è²å·åŸºäºæ‰«ç æ¬¡æ•°çš„å·¥åºè¯†åˆ«
- âœ… åŠ¨æ€é˜²é‡å¤æœºåˆ¶
- âœ… å·¥åºæ—¶é—´é…ç½®ç³»ç»Ÿ
- âœ… è²å·æ•°æ®éªŒè¯
- âœ… ç•Œé¢ä¼˜åŒ–ï¼šç”Ÿäº§èŠ‚ç‚¹é€‰æ‹©å™¨
- âœ… ç§»é™¤è¿‡æ—¶çš„"ç¼åˆ¶(è®¡ä»¶)"é€‰é¡¹

**v1.0** - ä¹‹å‰ç‰ˆæœ¬
- åŸºç¡€æ‰«ç åŠŸèƒ½
- æ‰‹åŠ¨é€‰æ‹©å·¥åº
- å›ºå®šé˜²é‡å¤æ—¶é—´ï¼ˆ30ç§’ï¼‰

---

## ğŸš€ æœªæ¥è§„åˆ’

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰
- [ ] æ‰«ç è®°å½•æ”¯æŒæ‰¹é‡æ’¤é”€
- [ ] é˜²é‡å¤æ—¶é—´å­¦ä¹ ç®—æ³•ï¼ˆæ ¹æ®å†å²æ•°æ®ä¼˜åŒ–ï¼‰
- [ ] å·¥åºå®Œæˆåº¦å®æ—¶çœ‹æ¿

### ä¸­æœŸï¼ˆ1ä¸ªæœˆï¼‰
- [ ] å·¥äººè®¡ä»¶æŠ¥è¡¨è‡ªåŠ¨ç”Ÿæˆ
- [ ] å¼‚å¸¸æ‰«ç é¢„è­¦ï¼ˆé€Ÿåº¦è¿‡å¿«/è¿‡æ…¢ï¼‰
- [ ] å·¥åºæ—¶é—´è‡ªåŠ¨ä¼˜åŒ–å»ºè®®

### é•¿æœŸï¼ˆ3ä¸ªæœˆï¼‰
- [ ] AIé¢„æµ‹å·¥åºå®Œæˆæ—¶é—´
- [ ] ç”Ÿäº§è¿›åº¦å¯è§†åŒ–å¤§å±
- [ ] å¤šå·¥åºå¹¶è¡Œæ”¯æŒ

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»æŠ€æœ¯å›¢é˜Ÿæˆ–æŸ¥é˜…ï¼š
- ä»£ç æ–‡ä»¶ï¼š`miniprogram/pages/scan/index.js`
- APIæ–‡æ¡£ï¼š`backend/README.md`
- é…ç½®ç•Œé¢ï¼šPCç«¯ â†’ æ¨¡æ¿ä¸­å¿ƒ

---

**æ–‡æ¡£ç»´æŠ¤è€…**ï¼šç³»ç»Ÿå¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**ï¼š2026å¹´1æœˆ22æ—¥
# ğŸ¯ SKUç»Ÿä¸€ç³»ç»Ÿ - å¿«é€Ÿå‚è€ƒè¡¨

## ğŸ“Œ æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | å®šä¹‰ | ç»„æˆ | ç¤ºä¾‹ |
|------|------|------|------|
| **SKU** | æœ€å°åº“å­˜å•ä½ | styleNo + color + size | ST001 + é»‘è‰² + L |
| **è®¢å•** | SKUçš„é›†åˆ | orderNo + items(SKUåˆ—è¡¨) | PO20260122001 (2-3ä¸ªSKU) |
| **è²å·** | è£å‰ªåçš„äº§ç‰© | orderNo + color + batchNo | PO20260122001-é»‘è‰²-01 |
| **æ•°é‡** | æœ€å°å•ä½ | ä»¶(ä¸ª) | 50ä»¶ |

---

## ğŸ”„ ä¸‰ç§æ‰«ç æ¨¡å¼

### 1ï¸âƒ£ è®¢å•æ‰«ç  (ORDER)

```
äºŒç»´ç : PO20260122001
â†“
è¯†åˆ«: è¿™æ˜¯è®¢å•å·
â†“
è·å–: è®¢å•è¯¦æƒ… + SKUåˆ—è¡¨
â†“
æ˜¾ç¤º: SKUæ˜ç»†è¡¨å• (ç”¨æˆ·é€‰æ‹©æ•°é‡)
â†“
æäº¤: é€ä¸ªSKUå‘é€è¯·æ±‚
```

**ä½•æ—¶ç”¨**: é¦–æ¬¡è¿›å…¥å·¥åºæ—¶ï¼Œéœ€è¦ç¡®è®¤å„SKUçš„å¤„ç†æ•°é‡

---

### 2ï¸âƒ£ è²å·æ‰«ç  (BUNDLE)

```
äºŒç»´ç : PO20260122001-é»‘è‰²-01
â†“
è¯†åˆ«: è¿™æ˜¯è²å·
â†“
è·å–: è²å·ä¿¡æ¯ (ä¸€ä¸ªé¢œè‰²ï¼Œå¯èƒ½å¤šä¸ªå°ºç )
â†“
æ˜¾ç¤º: ç›´æ¥ç¡®è®¤ (æ— éœ€é€‰æ‹©)
â†“
æäº¤: æŒ‰è²å·æ•°é‡æ‰¹é‡æäº¤
```

**ä½•æ—¶ç”¨**: è£å‰ªåæœ‰è²å·æ—¶ï¼Œå¿«é€Ÿæ‰«ç æäº¤

---

### 3ï¸âƒ£ SKUæ‰«ç  (SKU)

```
äºŒç»´ç : {orderNo: 'PO...', color: 'é»‘è‰²', size: 'L', qty: 50}
â†“
è¯†åˆ«: è¿™æ˜¯ä¸€ä¸ªSKU
â†“
è·å–: éªŒè¯SKUæ˜¯å¦åœ¨è®¢å•ä¸­å­˜åœ¨
â†“
æ˜¾ç¤º: ç›´æ¥ç¡®è®¤ (å›ºå®šæ•°é‡)
â†“
æäº¤: å•ä¸ªSKUæäº¤
```

**ä½•æ—¶ç”¨**: ç‰¹å®šåœºæ™¯ï¼Œå¦‚è´¨æ£€å…¥åº“æ—¶åªæ‰«ç‰¹å®šSKU

---

## ğŸ“Š æ•°æ®ç»“æ„é€ŸæŸ¥

### SKUå¯¹è±¡

```javascript
{
  // === å”¯ä¸€æ ‡è¯† ===
  styleNo: 'ST001',         // æ¬¾å·
  color: 'é»‘è‰²',            // é¢œè‰²
  size: 'L',                // å°ºç 
  orderNo: 'PO20260122001', // è®¢å•å·
  
  // === æ•°é‡ ===
  totalQuantity: 50,        // è®¢å•æ•°
  completedQuantity: 30,    // å·²å®Œæˆ
  pendingQuantity: 20,      // å¾…å®Œæˆ (= total - completed)
  
  // === å¯é€‰ ===
  bundleNo: 'PO-é»‘è‰²-01'   // å…³è”è²å·
}
```

### è®¢å•å¯¹è±¡

```javascript
{
  // === åŸºæœ¬ä¿¡æ¯ ===
  orderNo: 'PO20260122001',
  styleNo: 'ST001',
  styleName: 'è¿è¡£è£™',
  
  // === SKUæ˜ç»† ===
  items: [
    {color: 'é»‘è‰²', size: 'L', quantity: 50, completedQty: 30},
    {color: 'é»‘è‰²', size: 'M', quantity: 30, completedQty: 0},
    ...
  ],
  
  // === è¿›åº¦ ===
  currentStage: 'è£å‰ª',
  progressWorkflow: {...}
}
```

### æ‰«ç è¯·æ±‚

```javascript
{
  orderNo: 'PO20260122001',  // å¿…å¡«
  styleNo: 'ST001',           // å¿…å¡«
  color: 'é»‘è‰²',              // å¿…å¡«
  size: 'L',                  // å¿…å¡«
  quantity: 50,               // å¿…å¡«
  processNode: 'è£å‰ª',        // å¿…å¡« (é‡‡è´­/è£å‰ª/è½¦ç¼/è´¨æ£€/å…¥åº“)
  bundleNo: 'PO-é»‘è‰²-01',    // å¯é€‰ (æœ‰è²å·æ—¶)
  operatorId: 'OP001',        // å¯é€‰
  remark: 'å¤‡æ³¨'              // å¯é€‰
}
```

---

## ğŸ› ï¸ SKUProcessor å¸¸ç”¨æ–¹æ³•

### è§„èŒƒåŒ–

```javascript
// å°†åç«¯è¿”å›çš„itemsè½¬æ¢ä¸ºæ ‡å‡†SKUåˆ—è¡¨
const skuList = SKUProcessor.normalizeOrderItems(
  items,        // åç«¯è¿”å›çš„è®¢å•æ˜ç»†
  orderNo,      // è®¢å•å·
  styleNo       // æ¬¾å·
);
```

### æ„å»ºè¡¨å•

```javascript
// ç”¨äºå¼¹çª—æ˜¾ç¤º
const formItems = SKUProcessor.buildSKUInputList(skuList);
// è¿”å›: [
//   { label: 'é»‘è‰²/L', color, size, totalQuantity, inputQuantity },
//   { label: 'é»‘è‰²/M', ... },
//   ...
// ]
```

### éªŒè¯

```javascript
// å•ä¸ªSKUéªŒè¯
const result = SKUProcessor.validateSKUInput(input);
if (!result.valid) {
  console.error(result.error);
}

// æ‰¹é‡éªŒè¯
const batch = SKUProcessor.validateSKUInputBatch(skuInputList);
console.log(batch.validList);  // æœ‰æ•ˆçš„åˆ—è¡¨
console.log(batch.errors);     // é”™è¯¯ä¿¡æ¯
```

### ç”Ÿæˆè¯·æ±‚

```javascript
// è½¬æ¢ä¸ºæ‰«ç è¯·æ±‚æ ¼å¼
const requests = SKUProcessor.generateScanRequests(
  validList,      // éªŒè¯åçš„æœ‰æ•ˆåˆ—è¡¨
  orderNo,
  styleNo,
  processNode     // å·¥åºå
);
// å¯ç›´æ¥è°ƒç”¨ api.production.executeScan(requests)
```

### è®¡ç®—ç»Ÿè®¡

```javascript
// è·å–è®¢å•çš„æ€»ä½“è¿›åº¦
const summary = SKUProcessor.getSummary(skuList);
// è¿”å›: {
//   totalSKUs: 2,
//   completedSKUs: 1,
//   pendingSKUs: 1,
//   totalQuantity: 80,
//   completedQuantity: 50,
//   pendingQuantity: 30,
//   overallProgress: 62.5%
// }
```

---

## âš ï¸ å¸¸è§é”™è¯¯å’Œä¿®å¤

| é”™è¯¯ | åŸå›  | ä¿®å¤ |
|------|------|------|
| SKUåœ¨è®¢å•ä¸­ä¸å­˜åœ¨ | é¢œè‰²æˆ–å°ºç å†™é”™ | æ£€æŸ¥å°ç¨‹åºå’Œåç«¯çš„æ‹¼å†™ä¸€è‡´æ€§ |
| æ•°é‡è¶…é¢ | inputQty > totalQty | éªŒè¯æ—¶åŠ å…¥ä¸Šé™æ£€æŸ¥ |
| æ²¡æœ‰è¯†åˆ«å‡ºäºŒç»´ç æ ¼å¼ | äºŒç»´ç ä¸ç¬¦åˆè§„èŒƒ | ç¡®ä¿äºŒç»´ç æŒ‰æ ‡å‡†æ ¼å¼ç”Ÿæˆ |
| è²å·è§£æå¤±è´¥ | æ ¼å¼ä¸æ˜¯ order-color-seq | æ£€æŸ¥è²å·ç”Ÿæˆé€»è¾‘ |
| SKUé‡å¤ | è®¢å•ä¸­æœ‰é‡å¤çš„color/size | åç«¯ä¿å­˜æ—¶éœ€è¦å»é‡ |

---

## ğŸ“‹ è¿ç§»æ£€æŸ¥æ¸…å•

### Phase 2: å°ç¨‹åºæ”¹é€ 

- [ ] ScanHandler.js å¯¼å…¥ SKUProcessor
- [ ] ScanHandler çš„ SKU å¤„ç†æ”¹ç”¨ SKUProcessor
- [ ] index.js çš„ showConfirmModal æ”¹ç”¨ SKUProcessor
- [ ] è¡¨å•éªŒè¯æ”¹ç”¨ SKUProcessor.validateSKUInputBatch
- [ ] WXML æ˜¾ç¤ºæ–°çš„ summary ç»Ÿè®¡
- [ ] æµ‹è¯•ä¸‰ç§æ‰«ç æ¨¡å¼éƒ½èƒ½æ­£å¸¸å·¥ä½œ

### Phase 3: åç«¯æ”¹é€ 

- [ ] åˆ›å»º SKUService ç±»
- [ ] æ·»åŠ  ScanRecord.scanType å­—æ®µ
- [ ] æ›´æ–° ScanController ä½¿ç”¨æ–°çš„è¯·æ±‚æ ¼å¼
- [ ] æ·»åŠ  SKUçº§åˆ«çš„éªŒè¯
- [ ] æµ‹è¯•æ•°æ®ä¸€è‡´æ€§

### Phase 4: PCç«¯æ”¹é€ 

- [ ] OrderDetail.tsx æ˜¾ç¤º SKU è¿›åº¦è¡¨æ ¼
- [ ] æ˜¾ç¤ºæ¯ä¸ª SKU çš„å®Œæˆè¿›åº¦
- [ ] æ˜¾ç¤ºè®¢å•æ€»ä½“è¿›åº¦
- [ ] æ·»åŠ è‰²å€¼å’Œå°ºç çš„æœç´¢è¿‡æ»¤

---

## ğŸ”— æ–‡ä»¶å¯¹åº”å…³ç³»

```
SKU_UNIFIED_DESIGN.md          (è®¾è®¡æ–‡æ¡£ï¼Œ900è¡Œ)
â”œâ”€ æ¦‚å¿µå®šä¹‰
â”œâ”€ åç«¯ç»“æ„ (Java)
â”œâ”€ å°ç¨‹åºç»“æ„ (JS)
â”œâ”€ åç«¯æµç¨‹è®¾è®¡
â”œâ”€ PCç«¯æ˜¾ç¤ºè§„èŒƒ
â”œâ”€ æ•°æ®éªŒè¯è§„åˆ™
â””â”€ è¿ç§»è®¡åˆ’æ¡†æ¶

SKUProcessor.js                (å®ç°æ¨¡å—ï¼Œ450è¡Œ)
â”œâ”€ è§„èŒƒåŒ–: normalizeOrderItems()
â”œâ”€ æ„å»º: buildSKUInputList()
â”œâ”€ éªŒè¯: validateSKUInputBatch()
â”œâ”€ è½¬æ¢: generateScanRequests()
â”œâ”€ ç»Ÿè®¡: getSummary()
â””â”€ å·¥å…·: parseBundle(), formatDisplay() ç­‰

SKU_MIGRATION_GUIDE.md         (æ‰§è¡ŒæŒ‡å—ï¼Œ500è¡Œ)
â”œâ”€ Phase 2: å°ç¨‹åºæ”¹é€ 
â”œâ”€ Phase 3: åç«¯æ”¹é€ 
â”œâ”€ Phase 4: PCç«¯æ”¹é€ 
â”œâ”€ Phase 5: æµ‹è¯•éªŒè¯
â””â”€ æ—¶é—´çº¿è§„åˆ’

SKU_DATA_FLOW_DIAGRAM.md       (æµç¨‹å›¾ï¼Œ600è¡Œ)
â”œâ”€ è®¢å•æ‰«ç æµç¨‹ (ORDER)
â”œâ”€ è²å·æ‰«ç æµç¨‹ (BUNDLE)
â”œâ”€ SKUä¿¡æ¯æŸ¥è¯¢
â”œâ”€ æ•°æ®åº“ç»“æ„å…³ç³»
â”œâ”€ å°ç¨‹åºé¡µé¢æ•°æ®æµ
â””â”€ å¯¹è±¡å®šä¹‰å›¾è§£
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ€å°åŒ–æ”¹é€  (åªæ”¹å°ç¨‹åº)

```javascript
// 1. åœ¨ pages/scan/index.js å¼•å…¥
const SKUProcessor = require('./processors/SKUProcessor');

// 2. åœ¨ showConfirmModal ä¸­ä½¿ç”¨
showConfirmModal(data) {
  const skuList = SKUProcessor.normalizeOrderItems(data.skuItems, data.orderNo, data.styleNo);
  const formItems = SKUProcessor.buildSKUInputList(skuList);
  const summary = SKUProcessor.getSummary(skuList);
  
  this.setData({
    scanConfirm: {
      skuList: formItems,
      summary: summary
    }
  });
}

// 3. åœ¨ onConfirmSubmit ä¸­éªŒè¯å’Œæäº¤
async onConfirmSubmit() {
  const batch = SKUProcessor.validateSKUInputBatch(this.data.scanConfirm.skuList);
  if (!batch.valid) {
    wx.showToast({ title: batch.errors[0], icon: 'none' });
    return;
  }
  
  const requests = SKUProcessor.generateScanRequests(
    batch.validList,
    this.data.scanConfirm.detail.orderNo,
    this.data.scanConfirm.detail.styleNo,
    this.data.scanConfirm.detail.progressStage
  );
  
  try {
    await Promise.all(requests.map(r => api.production.executeScan(r)));
    wx.showToast({ title: 'æˆåŠŸ', icon: 'success' });
  } catch (e) {
    wx.showToast({ title: e.message, icon: 'none' });
  }
}
```

### å®Œæ•´æ”¹é€  (ä¸‰ç«¯ç»Ÿä¸€)

å‚è€ƒ SKU_MIGRATION_GUIDE.md çš„ Phase 2-5

---

## ğŸ“ é—®é¢˜æ’æŸ¥

**é—®é¢˜**: SKUåœ¨è®¢å•ä¸­ä¸å­˜åœ¨
```javascript
// æ’æŸ¥æ­¥éª¤
1. æ£€æŸ¥åç«¯è¿”å›çš„ items ä¸­æ˜¯å¦æœ‰è¯¥é¢œè‰²å°ºç 
2. æ£€æŸ¥å°ç¨‹åºçš„ color/size æ‹¼å†™æ˜¯å¦ä¸€è‡´
3. æ£€æŸ¥æ˜¯å¦æ˜¯ trim() å¯¼è‡´çš„ç©ºæ ¼é—®é¢˜
```

**é—®é¢˜**: æ•°é‡è¶…è¿‡è®¢å•æ•°
```javascript
// æ’æŸ¥æ­¥éª¤
1. æ£€æŸ¥ validat

eSKUInput æ˜¯å¦è°ƒç”¨äº†
2. æ£€æŸ¥ input.totalQuantity æ˜¯å¦æ­£ç¡®èµ‹å€¼
3. æ£€æŸ¥åç«¯æ˜¯å¦æ­£ç¡®è¿”å›äº† quantity å­—æ®µ
```

**é—®é¢˜**: è²å·æ— æ³•è¯†åˆ«
```javascript
// æ’æŸ¥æ­¥éª¤
1. æ£€æŸ¥è²å·æ ¼å¼æ˜¯å¦ä¸º orderNo-color-seq
2. æ£€æŸ¥é¢œè‰²æ˜¯å¦æœ‰ç‰¹æ®Šå­—ç¬¦
3. æ£€æŸ¥æ˜¯å¦éœ€è¦ URL encode
```

---

**æœ€åæ›´æ–°**: 2026-01-23  
**ç‰ˆæœ¬**: 1.0 (è®¾è®¡å’Œå·¥å…·åº“å·²å°±ç»ªï¼Œå¾…é˜¶æ®µæ€§æ”¹é€ )

